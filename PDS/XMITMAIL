./ ADD NAME=$$README 0124-98352-10217-2304-00030-00053-00000-TSO057
      See member XMITDOC








      Copyright (C) 2000  Andy Robertson

      This program is free software; you can redistribute it and/or
      modify it under the terms of the GNU General Public License as
      published by the Free Software Foundation; either version 2 of the
      License, or (at your option) any later version.

      This program is distributed in the hope that it will be useful,
      but WITHOUT ANY WARRANTY; without even the implied warranty of
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      GNU General Public License for more details.

      You should have received a copy of the GNU General Public License
      along with this program; if not, write to the Free Software
      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.






./ ADD NAME=XMITBND  0106-05060-05069-1701-00056-00023-00000-TSO057

      **************************************************************
      *   XMITBND
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITBND' .

      ******************************************************************
      *                                                                *
      * CREATE A 37-BYTE BOUNDARY TOKEN                                *
      *                                                                *
      ******************************************************************
       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       LINKAGE         SECTION.

       01   XMITMAIL-BND  PIC X(37).


       PROCEDURE DIVISION USING XMITMAIL-BND.


             MOVE
                   'ab1234tyrewwuytdfghjksillrhgo0x0zax1d'
             TO XMITMAIL-BND

             STRING
                   'Mime.XMITMAIL.'  FUNCTION CURRENT-DATE (1:16)
             DELIMITED SIZE INTO XMITMAIL-BND

             GOBACK

             .
       END PROGRAM   'XMITBND'.
./ ADD NAME=XMITCHAR 0105-05091-10217-2305-00604-00550-00056-TSO057
000100
000110
000120************************************************************
000130*   XMITCHAR batch e-mail subroutine
000140*   Copyright (C) 2000  Andy Robertson
000150*
000160*   This program is free software; you can redistribute
000170*   it and/or modify it under the terms of the GNU
000180*   General Public License as published by the Free
000190*   Software Foundation; either version 2 of the
000191*   License, or (at your option) any later version.
000192*
000193*   This program is distributed in the hope that it
000194*   will be useful, but WITHOUT ANY WARRANTY; without
000195*   even the implied warranty of MERCHANTABILITY or
000196*   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
000197*   General Public License for more details.
000198*
000199*   You should have received a copy of the GNU General
000200*   Public License along with this program; if not,
000201*   write to the Free Software Foundation, Inc., 675
000202*   Mass Ave, Cambridge, MA 02139, USA.
000203*
000204************************************************************
000205
000210
000300 IDENTIFICATION DIVISION.
000400 PROGRAM-ID.
000500        'XMITCHAR'.
000600
000700******************************************************************
000800*                                                                *
000900* CONVERT FROM 64-bit mime                                       *
001000*                                                                *
001010***
001020*** Processing may end by
001030***
001040*** 0) input field exhausted
001041***
001050*** 1) a well-formed quartet including 'mm==' where mm <= 255
001060*** 2) a well-formed quartet including 'mmm=' where mmm <= 65535
001070***
001080*** Where m is any valid mime char
001090***
001091*** 3) a quartet beginning with byte space      'b???'
001092*** 4) a quartet beginning with byte low-values '0???'
001093***
001094*** Where ? is any char
001095***
001096*** Input field exhaustion gives reply 'V'
001097***
001098*** Termination by a well formed quartet gives reply 'V' if it
001099*** is the last quartet in the input and 'P' if not
001100***
001101*** Termination by space or low value gives a reply of
001102*** 'P'
001103***
001104*** Other premature terminations including partial quartets
001105*** or other non-mime characters
001106***
001107*** in the input field are errors and return 'E'
001108***
001109*** errors return all data possible
001110***
001120******************************************************************
001200
001300 ENVIRONMENT DIVISION.
001400 DATA DIVISION.
001500 WORKING-STORAGE SECTION.
001600
001700 01   W-CHAR-OFFSET PIC S9(8) COMP.
001800 01   W-64-OFFSET PIC S9(8) COMP.
001900
002000 01   w-quartet-x.
002100      04 w-quartet     PIC S9(8) COMP.
002200
002300 01   W-triplet-x.
002400      04 W-triplet     PIC S9(8) COMP.
002500
002600 01   W-quartet-mimevalue-1-x.
002700      04 W-quartet-mimevalue-1 PIC S9(8) COMP VALUE 0.
002800
002900 01   W-quartet-mimevalue-2-x.
003000      04 W-quartet-mimevalue-2 PIC S9(8) COMP VALUE 0.
003100
003200 01   W-quartet-mimevalue-3-x.
003300      04 W-quartet-mimevalue-3 PIC S9(8) COMP VALUE 0.
003400
003500 01   W-quartet-mimevalue-4-x.
003600      04 W-quartet-mimevalue-4 PIC S9(8) COMP VALUE 0.
003700
003800
003900 01   W-quartet-char-1-x.
004000      04 W-quartet-char-1     PIC S9(8) COMP VALUE 0.
004100
004200 01   W-quartet-char-2-x.
004300      04 W-quartet-char-2     PIC S9(8) COMP VALUE 0.
004400
004500 01   W-quartet-char-3-x.
004600      04 W-quartet-char-3     PIC S9(8) COMP VALUE 0.
004700
004800 01   W-quartet-char-4-x.
004900      04 W-quartet-char-4     PIC S9(8) COMP VALUE 0.
005000
005100 01   W-W    .
005200      04 premature-end   pic x.
005300      04 W-REMAIN      PIC S9(8) COMP.
005400      04 W-no-of-quartets PIC S9(8) COMP.
005500
005600 01   W-mimechars.
005700
005800**** 00
005900      04 FILLER PIC X VALUE x'ff'.
006000      04 FILLER PIC X VALUE x'ff'.
006100      04 FILLER PIC X VALUE x'ff'.
006200      04 FILLER PIC X VALUE x'ff'.
006300      04 FILLER PIC X VALUE x'ff'.
006400      04 FILLER PIC X VALUE x'ff'.
006500      04 FILLER PIC X VALUE x'ff'.
006600      04 FILLER PIC X VALUE x'ff'.
006700      04 FILLER PIC X VALUE x'ff'.
006800      04 FILLER PIC X VALUE x'ff'.
006900      04 FILLER PIC X VALUE x'ff'.
007000      04 FILLER PIC X VALUE x'ff'.
007100      04 FILLER PIC X VALUE x'ff'.
007200      04 FILLER PIC X VALUE x'ff'.
007300      04 FILLER PIC X VALUE x'ff'.
007400      04 FILLER PIC X VALUE x'ff'.
007500
007600**** 10
007700      04 FILLER PIC X VALUE x'ff'.
007800      04 FILLER PIC X VALUE x'ff'.
007900      04 FILLER PIC X VALUE x'ff'.
008000      04 FILLER PIC X VALUE x'ff'.
008100      04 FILLER PIC X VALUE x'ff'.
008200      04 FILLER PIC X VALUE x'ff'.
008300      04 FILLER PIC X VALUE x'ff'.
008400      04 FILLER PIC X VALUE x'ff'.
008500      04 FILLER PIC X VALUE x'ff'.
008600      04 FILLER PIC X VALUE x'ff'.
008700      04 FILLER PIC X VALUE x'ff'.
008800      04 FILLER PIC X VALUE x'ff'.
008900      04 FILLER PIC X VALUE x'ff'.
009000      04 FILLER PIC X VALUE x'ff'.
009100      04 FILLER PIC X VALUE x'ff'.
009200      04 FILLER PIC X VALUE x'ff'.
009300
009400
009500**** 20
009600      04 FILLER PIC X VALUE x'ff'.
009700      04 FILLER PIC X VALUE x'ff'.
009800      04 FILLER PIC X VALUE x'ff'.
009900      04 FILLER PIC X VALUE x'ff'.
010000      04 FILLER PIC X VALUE x'ff'.
010100      04 FILLER PIC X VALUE x'ff'.
010200      04 FILLER PIC X VALUE x'ff'.
010300      04 FILLER PIC X VALUE x'ff'.
010400      04 FILLER PIC X VALUE x'ff'.
010500      04 FILLER PIC X VALUE x'ff'.
010600      04 FILLER PIC X VALUE x'ff'.
010700      04 FILLER PIC X VALUE x'ff'.
010800      04 FILLER PIC X VALUE x'ff'.
010900      04 FILLER PIC X VALUE x'ff'.
011000      04 FILLER PIC X VALUE x'ff'.
011100      04 FILLER PIC X VALUE x'ff'.
011200
011300
011400**** 30
011500      04 FILLER PIC X VALUE x'ff'.
011600      04 FILLER PIC X VALUE x'ff'.
011700      04 FILLER PIC X VALUE x'ff'.
011800      04 FILLER PIC X VALUE x'ff'.
011900      04 FILLER PIC X VALUE x'ff'.
012000      04 FILLER PIC X VALUE x'ff'.
012100      04 FILLER PIC X VALUE x'ff'.
012200      04 FILLER PIC X VALUE x'ff'.
012300      04 FILLER PIC X VALUE x'ff'.
012400      04 FILLER PIC X VALUE x'ff'.
012500      04 FILLER PIC X VALUE x'ff'.
012600      04 FILLER PIC X VALUE x'ff'.
012700      04 FILLER PIC X VALUE x'ff'.
012800      04 FILLER PIC X VALUE x'ff'.
012900      04 FILLER PIC X VALUE x'ff'.
013000      04 FILLER PIC X VALUE x'ff'.
013100
013200
013300**** 40
013400      04 FILLER PIC X VALUE x'ff'.
013500      04 FILLER PIC X VALUE x'ff'.
013600      04 FILLER PIC X VALUE x'ff'.
013700      04 FILLER PIC X VALUE x'ff'.
013800      04 FILLER PIC X VALUE x'ff'.
013900      04 FILLER PIC X VALUE x'ff'.
014000      04 FILLER PIC X VALUE x'ff'.
014100      04 FILLER PIC X VALUE x'ff'.
014200      04 FILLER PIC X VALUE x'ff'.
014300      04 FILLER PIC X VALUE x'ff'.
014400      04 FILLER PIC X VALUE x'ff'.
014500      04 FILLER PIC X VALUE x'ff'.
014600      04 FILLER PIC X VALUE x'ff'.
014700      04 FILLER PIC X VALUE x'ff'.
014800      04 FILLER PIC X VALUE x'3E'.
014900      04 FILLER PIC X VALUE x'ff'.
015000
015100
015200**** 50
015300      04 FILLER PIC X VALUE x'ff'.
015400      04 FILLER PIC X VALUE x'ff'.
015500      04 FILLER PIC X VALUE x'ff'.
015600      04 FILLER PIC X VALUE x'ff'.
015700      04 FILLER PIC X VALUE x'ff'.
015800      04 FILLER PIC X VALUE x'ff'.
015900      04 FILLER PIC X VALUE x'ff'.
016000      04 FILLER PIC X VALUE x'ff'.
016100      04 FILLER PIC X VALUE x'ff'.
016200      04 FILLER PIC X VALUE x'ff'.
016300      04 FILLER PIC X VALUE x'ff'.
016400      04 FILLER PIC X VALUE x'ff'.
016500      04 FILLER PIC X VALUE x'ff'.
016600      04 FILLER PIC X VALUE x'ff'.
016700      04 FILLER PIC X VALUE x'ff'.
016800      04 FILLER PIC X VALUE x'ff'.
016900
017000
017100**** 60
017200      04 FILLER PIC X VALUE x'ff'.
017300      04 FILLER PIC X VALUE x'3f'.
017400      04 FILLER PIC X VALUE x'ff'.
017500      04 FILLER PIC X VALUE x'ff'.
017600      04 FILLER PIC X VALUE x'ff'.
017700      04 FILLER PIC X VALUE x'ff'.
017800      04 FILLER PIC X VALUE x'ff'.
017900      04 FILLER PIC X VALUE x'ff'.
018000      04 FILLER PIC X VALUE x'ff'.
018100      04 FILLER PIC X VALUE x'ff'.
018200      04 FILLER PIC X VALUE x'ff'.
018300      04 FILLER PIC X VALUE x'ff'.
018400      04 FILLER PIC X VALUE x'ff'.
018500      04 FILLER PIC X VALUE x'ff'.
018600      04 FILLER PIC X VALUE x'ff'.
018700      04 FILLER PIC X VALUE x'ff'.
018800
018900
019000**** 70
019100      04 FILLER PIC X VALUE x'ff'.
019200      04 FILLER PIC X VALUE x'ff'.
019300      04 FILLER PIC X VALUE x'ff'.
019400      04 FILLER PIC X VALUE x'ff'.
019500      04 FILLER PIC X VALUE x'ff'.
019600      04 FILLER PIC X VALUE x'ff'.
019700      04 FILLER PIC X VALUE x'ff'.
019800      04 FILLER PIC X VALUE x'ff'.
019900      04 FILLER PIC X VALUE x'ff'.
020000      04 FILLER PIC X VALUE x'ff'.
020100      04 FILLER PIC X VALUE x'ff'.
020200      04 FILLER PIC X VALUE x'ff'.
020300      04 FILLER PIC X VALUE x'ff'.
020400      04 FILLER PIC X VALUE x'ff'.
020500      04 FILLER PIC X VALUE x'40'.
020600      04 FILLER PIC X VALUE x'ff'.
020700
020800
020900**** 80
021000      04 FILLER PIC X VALUE x'ff'.
021100      04 FILLER PIC X VALUE x'1a'.
021200      04 FILLER PIC X VALUE x'1B'.
021300      04 FILLER PIC X VALUE x'1C'.
021400      04 FILLER PIC X VALUE x'1D'.
021500      04 FILLER PIC X VALUE x'1E'.
021600      04 FILLER PIC X VALUE x'1F'.
021700      04 FILLER PIC X VALUE x'20'.
021800      04 FILLER PIC X VALUE x'21'.
021900      04 FILLER PIC X VALUE x'22'.
022000      04 FILLER PIC X VALUE x'ff'.
022100      04 FILLER PIC X VALUE x'ff'.
022200      04 FILLER PIC X VALUE x'ff'.
022300      04 FILLER PIC X VALUE x'ff'.
022400      04 FILLER PIC X VALUE x'ff'.
022500      04 FILLER PIC X VALUE x'ff'.
022600
022700
022800**** 90
022900      04 FILLER PIC X VALUE x'ff'.
023000      04 FILLER PIC X VALUE x'23'.
023100      04 FILLER PIC X VALUE x'24'.
023200      04 FILLER PIC X VALUE x'25'.
023300      04 FILLER PIC X VALUE x'26'.
023400      04 FILLER PIC X VALUE x'27'.
023500      04 FILLER PIC X VALUE x'28'.
023600      04 FILLER PIC X VALUE x'29'.
023700      04 FILLER PIC X VALUE x'2A'.
023800      04 FILLER PIC X VALUE x'2B'.
023900      04 FILLER PIC X VALUE x'ff'.
024000      04 FILLER PIC X VALUE x'ff'.
024100      04 FILLER PIC X VALUE x'ff'.
024200      04 FILLER PIC X VALUE x'ff'.
024300      04 FILLER PIC X VALUE x'ff'.
024400      04 FILLER PIC X VALUE x'ff'.
024500
024600
024700**** A0
024800      04 FILLER PIC X VALUE x'ff'.
024900      04 FILLER PIC X VALUE x'ff'.
025000      04 FILLER PIC X VALUE x'2C'.
025100      04 FILLER PIC X VALUE x'2D'.
025200      04 FILLER PIC X VALUE x'2E'.
025300      04 FILLER PIC X VALUE x'2F'.
025400      04 FILLER PIC X VALUE x'30'.
025500      04 FILLER PIC X VALUE x'31'.
025600      04 FILLER PIC X VALUE x'32'.
025700      04 FILLER PIC X VALUE x'33'.
025800      04 FILLER PIC X VALUE x'ff'.
025900      04 FILLER PIC X VALUE x'ff'.
026000      04 FILLER PIC X VALUE x'ff'.
026100      04 FILLER PIC X VALUE x'ff'.
026200      04 FILLER PIC X VALUE x'ff'.
026300      04 FILLER PIC X VALUE x'ff'.
026400
026500
026600**** B0
026700      04 FILLER PIC X VALUE x'ff'.
026800      04 FILLER PIC X VALUE x'ff'.
026900      04 FILLER PIC X VALUE x'ff'.
027000      04 FILLER PIC X VALUE x'ff'.
027100      04 FILLER PIC X VALUE x'ff'.
027200      04 FILLER PIC X VALUE x'ff'.
027300      04 FILLER PIC X VALUE x'ff'.
027400      04 FILLER PIC X VALUE x'ff'.
027500      04 FILLER PIC X VALUE x'ff'.
027600      04 FILLER PIC X VALUE x'ff'.
027700      04 FILLER PIC X VALUE x'ff'.
027800      04 FILLER PIC X VALUE x'ff'.
027900      04 FILLER PIC X VALUE x'ff'.
028000      04 FILLER PIC X VALUE x'ff'.
028100      04 FILLER PIC X VALUE x'ff'.
028200      04 FILLER PIC X VALUE x'ff'.
028300
028400
028500**** C0
028600      04 FILLER PIC X VALUE x'ff'.
028700      04 FILLER PIC X VALUE x'00'.
028800      04 FILLER PIC X VALUE x'01'.
028900      04 FILLER PIC X VALUE x'02'.
029000      04 FILLER PIC X VALUE x'03'.
029100      04 FILLER PIC X VALUE x'04'.
029200      04 FILLER PIC X VALUE x'05'.
029300      04 FILLER PIC X VALUE x'06'.
029400      04 FILLER PIC X VALUE x'07'.
029500      04 FILLER PIC X VALUE x'08'.
029600      04 FILLER PIC X VALUE x'FF'.
029700      04 FILLER PIC X VALUE x'ff'.
029800      04 FILLER PIC X VALUE x'ff'.
029900      04 FILLER PIC X VALUE x'ff'.
030000      04 FILLER PIC X VALUE x'ff'.
030100      04 FILLER PIC X VALUE x'ff'.
030200
030300
030400**** D0
030500      04 FILLER PIC X VALUE x'ff'.
030600      04 FILLER PIC X VALUE x'09'.
030700      04 FILLER PIC X VALUE x'0A'.
030800      04 FILLER PIC X VALUE x'0B'.
030900      04 FILLER PIC X VALUE x'0C'.
031000      04 FILLER PIC X VALUE x'0D'.
031100      04 FILLER PIC X VALUE x'0E'.
031200      04 FILLER PIC X VALUE x'0F'.
031300      04 FILLER PIC X VALUE x'10'.
031400      04 FILLER PIC X VALUE x'11'.
031500      04 FILLER PIC X VALUE x'ff'.
031600      04 FILLER PIC X VALUE x'ff'.
031700      04 FILLER PIC X VALUE x'ff'.
031800      04 FILLER PIC X VALUE x'ff'.
031900      04 FILLER PIC X VALUE x'ff'.
032000      04 FILLER PIC X VALUE x'ff'.
032100
032200
032300**** E0
032400      04 FILLER PIC X VALUE x'ff'.
032500      04 FILLER PIC X VALUE x'ff'.
032600      04 FILLER PIC X VALUE x'12'.
032700      04 FILLER PIC X VALUE x'13'.
032800      04 FILLER PIC X VALUE x'14'.
032900      04 FILLER PIC X VALUE x'15'.
033000      04 FILLER PIC X VALUE x'16'.
033100      04 FILLER PIC X VALUE x'17'.
033200      04 FILLER PIC X VALUE x'18'.
033300      04 FILLER PIC X VALUE x'19'.
033400      04 FILLER PIC X VALUE x'ff'.
033500      04 FILLER PIC X VALUE x'ff'.
033600      04 FILLER PIC X VALUE x'ff'.
033700      04 FILLER PIC X VALUE x'ff'.
033800      04 FILLER PIC X VALUE x'ff'.
033900      04 FILLER PIC X VALUE x'ff'.
034000
034100
034200**** F0
034300      04 FILLER PIC X VALUE x'34'.
034400      04 FILLER PIC X VALUE x'35'.
034500      04 FILLER PIC X VALUE x'36'.
034600      04 FILLER PIC X VALUE x'37'.
034700      04 FILLER PIC X VALUE x'38'.
034800      04 FILLER PIC X VALUE x'39'.
034900      04 FILLER PIC X VALUE x'3A'.
035000      04 FILLER PIC X VALUE x'3B'.
035100      04 FILLER PIC X VALUE x'3C'.
035200      04 FILLER PIC X VALUE x'3D'.
035300      04 FILLER PIC X VALUE x'FF'.
035400      04 FILLER PIC X VALUE x'FF'.
035500      04 FILLER PIC X VALUE x'ff'.
035600      04 FILLER PIC X VALUE x'ff'.
035700      04 FILLER PIC X VALUE x'ff'.
035800      04 FILLER PIC X VALUE x'ff'.
035900
036000
036100 linkage         section.
036200
036300 01   f-64          pic x(9999999).
036400 01   f-64-length   pic s9(8) comp.
036500 01   f-char        pic x(9999999).
036600 01   f-char-length pic s9(8) comp.
036700 01   f-reply       pic x.
036800
036900
037000 procedure division using
037100         f-64
037200         f-64-length
037300         f-char
037400         f-char-length
037500         f-reply
037600       .
037700
037800     if f-64-length < 1
037900       move 'V' to f-reply
038000       move 0 to f-char-length
038100       goback
038200     end-if
038300
038400
038500
038600     divide f-64-length by 4 giving w-no-of-quartets
038700         remainder w-remain
038710
038720
038730     move 0 to f-char-length
038740
038750***
038760*** Processing may end by
038770***
038780*** 0) input field exhausted
038790*** 1) a well-formed quartet including 'mm==' where mm <= 255
038800*** 2) a well-formed quartet including 'mmm=' where mmm <= 65535
038900***
039000*** Where m is a valid mime char
039100***
039200*** 3) a byte space                    'b???'
039300*** 4) a byte low-values               '0???'
039400***
039500*** Where ? is any char
039600***
039700*** Input field exhaustion lives reply 'V'
039800***
039900*** Termination by a well formed quartet gives reply 'V' if it
040000*** is the last quartet in the input and 'P' if not
040100***
040200*** Termination by space or low value gives a reply of
040300*** 'P'
040400***
040500*** Other premature terminations including partial quartets
040600*** or other non-mime characters
040700*** in the input field are errors and return 'E'
040800***
040900*** errors return all data possible
041000***
041100
041200
041300
041400     move 1 to w-char-offset
041500     move 1 to w-64-offset
041600     move 'n' to premature-end
041700
041800     move 'P' to f-reply
041900     perform until w-no-of-quartets < 1
042000       perform one-quartet
042100     end-perform
042200
042300     if w-remain not = 0
042400       move 'E' to f-reply
042500       goback
042510     end-if
042520
042530     move 'V' to f-reply
042540     goback  .
042550
042560
042570
042580     .
042590 one-quartet.
042600
042700     move f-64(w-64-offset:4) to w-quartet-x
042800
042900     if w-quartet-x(1:1) = ' '
043000       move 'P' to f-reply
043100       goback
043200     end-if
043300
043400     if w-quartet-x(1:1) = low-values
043500       move 'P' to f-reply
043600       goback
043700     end-if
043800
043900     move 0               to w-quartet-char-1
044000     move 0               to w-quartet-char-2
044100     move 0               to w-quartet-char-3
044200     move 0               to w-quartet-char-4
044300     move w-quartet-x(1:1) to w-quartet-char-1-x(4:1)
044400     move w-quartet-x(2:1) to w-quartet-char-2-x(4:1)
044500     move w-quartet-x(3:1) to w-quartet-char-3-x(4:1)
044600     move w-quartet-x(4:1) to w-quartet-char-4-x(4:1)
044700     add 1                to w-quartet-char-1
044800     add 1                to w-quartet-char-2
044900     add 1                to w-quartet-char-3
045000     add 1                to w-quartet-char-4
045100
045200     move w-mimechars(w-quartet-char-1:1) to
045300      w-quartet-mimevalue-1-x(4:1)
045400     move w-mimechars(w-quartet-char-2:1) to
045500      w-quartet-mimevalue-2-x(4:1)
045600     move w-mimechars(w-quartet-char-3:1) to
045700      w-quartet-mimevalue-3-x(4:1)
045800     move w-mimechars(w-quartet-char-4:1) to
045900      w-quartet-mimevalue-4-x(4:1)
046000
046100****
046200**** The mime values now contain 0 to 63 if they are valid
046300**** mime characters, 64 if they are =, or 255 if they are
046400**** not valid
046500****
046600     if w-quartet-mimevalue-1 = 255
046700     or w-quartet-mimevalue-2 = 255
046800     or w-quartet-mimevalue-3 = 255
046900     or w-quartet-mimevalue-4 = 255
047000       move 'E' to f-reply
047100       goback
047200     end-if
047300
047400
047500     evaluate true
047600     when w-quartet-mimevalue-1 not = 64
047700     and  w-quartet-mimevalue-2 not = 64
047800     and  w-quartet-mimevalue-3 not = 64
047900     and  w-quartet-mimevalue-4 not = 64
048000       compute w-triplet =
048100         (w-quartet-mimevalue-1 * (64**3))
048200       + (w-quartet-mimevalue-2 * (64**2))
048300       + (w-quartet-mimevalue-3 * (64**1))
048400       + (w-quartet-mimevalue-4)
048500       move w-triplet-x(2:3) to f-char(w-char-offset:3)
048600       add 4 to w-64-offset
048700       add 3 to w-char-offset
048800       add 3 to f-char-length
048900       subtract 1 from w-no-of-quartets
049000     when w-quartet-mimevalue-1 not = 64
049100     and  w-quartet-mimevalue-2 not = 64
049200     and  w-quartet-mimevalue-3 not = 64
049300     and  w-quartet-mimevalue-4     = 64
049400       compute w-triplet =
049500         (w-quartet-mimevalue-1 * (64**2))
049600       + (w-quartet-mimevalue-2 * (64**1))
049700       + (w-quartet-mimevalue-3)
049800
049900       if w-triplet > 65535
050000         move 'E' to f-reply
050100         goback
050200       end-if
050300       move w-triplet-x(3:2) to f-char(w-char-offset:2)
050400       add 2 to f-char-length
050500       subtract 1 from w-no-of-quartets
050600       if w-no-of-quartets < 1
050700         move 'V' to f-reply
050800       end-if
050900       goback
051000     when w-quartet-mimevalue-1 not = 64
051100     and  w-quartet-mimevalue-2 not = 64
051200     and  w-quartet-mimevalue-3     = 64
051300     and  w-quartet-mimevalue-4     = 64
051400       compute w-triplet =
051500         (w-quartet-mimevalue-1 * (64**1))
051600       + (w-quartet-mimevalue-2)
051700       if w-triplet > 255
051800         move 'E' to f-reply
051900         goback
052000       end-if
052100       move w-triplet-x(4:1) to f-char(w-char-offset:1)
052200       add 1 to f-char-length
052300       subtract 1 from w-no-of-quartets
052400       if w-no-of-quartets < 1
052500         move 'V' to f-reply
052600       end-if
052700       goback
052800     end-evaluate
052900
053000
053100     .
053200 end program xmitchar.
./ ADD NAME=XMITCICS 0144-00332-10264-1548-00309-00139-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * SUBROUTINE TO SEND a SIMPLE E-MAIL BY SPOOLING OUTPUT TO       *
      * SMTP.  RUNS UNDER CICS.                                        *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 Nov 2000 1.1  written                                  AWR  *
      * 26 JUL 2010 1.6  SECURE mode spport                       AWR  *
      *                                                                *
      ******************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITCICS'.
       ENVIRONMENT DIVISION.
       DATA DIVISION.



       WORKING-STORAGE SECTION.


       01  USER-ID                        PIC X(8).
       01  NJE-NODE                       PIC X(8).
       01  DUMMY-UNSTRING                 PIC X(8).
       01  DUMMY-UNSTRING2                PIC X(8).
       01  W-FROM                         PIC X(80).

       01  W-TOKEN                        PIC X(8).

       01  W-RESP  PIC 9(8) VALUE 0.
       01  W-RESP2 PIC 9(8) VALUE 0.

       01  W-OUTPUT-POINTER1 USAGE POINTER.
       01  W-OUTPUT-POINTER2 USAGE POINTER.
       01  W-OUTPUT-STATEMENT.
           04  W-OUTPUT-STATEMENT-LENGTH PIC S9(8) COMP VALUE 100.
           04  W-OUTPUT-STATEMENT-PARMS  PIC X(100) VALUE ' '.


       01   OUTFILE-LENGTH         PIC 9(8) COMP.


       01   W-WORK.
            04   XMITINMR-CHARNO   PIC S9(8) COMP.
            04   XMITMAFM-CHARNO   PIC S9(8) COMP.
            04   OUTFILE-CHARNO    PIC S9(8) COMP.
            04   W-LINE            PIC X(256).


       01   XMITMAFM-RECL         PIC S9(8) COMP.
       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.
       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.


       01   XMITMAFM-BACK.
            04   FILLER            PIC X(800).
            04   XMITMAIL-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.

       01   XMITINMR-BACK.
            04   FILLER            PIC X(800).
            04   XMITINMR-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.


       COPY XMITMADF.


       LINKAGE SECTION.

       01   DFHCOMMAREA.
            COPY XMITMACC.


       PROCEDURE DIVISION.

           MOVE 'C' TO XMITMAIL-ENV


           MOVE 'E' TO XMITMAIL-REPLY
           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC

           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL
           IF 80 > XMITMAFM-RECL
               MOVE 80 TO XMITMAFM-RECL
           END-IF
           ADD 1 TO XMITMAFM-RECL
      *    FOR POSS INITIAL PERIOD

           PERFORM CALL-EXIT


           IF XMITMAIL-SECURE= 'Y'
               MOVE XMITMAIL-NJE-NODE TO NJE-NODE
               IF NJE-NODE = SPACE OR LOW-VALUE

                   MOVE XMITMAIL-FROM TO W-FROM
                   IF W-FROM = HIGH-VALUES OR SPACES
                       MOVE XMITMAIL-FROM-DEFAULT TO W-FROM
                   END-IF
                   UNSTRING W-FROM DELIMITED '@'
                   INTO DUMMY-UNSTRING DUMMY-UNSTRING2
                   UNSTRING DUMMY-UNSTRING2 DELIMITED '.'
                   INTO NJE-NODE DUMMY-UNSTRING2
               END-IF
               EXEC CICS ASSIGN USERID(USER-ID)
               END-EXEC
           END-IF
           PERFORM FORMAT-MESSAGE
           PERFORM ALLOC-OUTFILE
           PERFORM OPEN-OUTFILE
           PERFORM WRITE-MESSAGE
           PERFORM CLOSE-OUTFILE
           PERFORM FREE-OUTFILE

           MOVE 'V' TO XMITMAIL-REPLY
           MOVE ' ' TO XMITMAIL-DIAGNOSTIC
           MOVE 0 TO RETURN-CODE
           GOBACK

           .





           .
       OPEN-OUTFILE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY ' '
               DISPLAY '....  SPOOL FILE STARTS  .... '
           ELSE

               EXEC CICS SPOOLOPEN
                    OUTPUT
                    TOKEN(W-TOKEN)
                    OUTDESCR(W-OUTPUT-POINTER1)
                    USERID('*')
                    NODE('*')
                    CLASS('A')
                    RECORDLENGTH(LENGTH OF W-LINE)
                    RESP (W-RESP) RESP2 (W-RESP2)
               END-EXEC

               IF W-RESP NOT = 00
                   STRING 'XMITCICS: SPOOLOPEN '
                   'FAILED RESP=' W-RESP ' RESP2=' W-RESP2
                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
                   MOVE 'I' TO XMITMAIL-REPLY
                   MOVE 0 TO RETURN-CODE
                   GOBACK
               END-IF
           END-IF





           .
       WRITE-LINE-SECURE.
           PERFORM WRITE-LINE



           .
       WRITE-LINE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY W-LINE
           ELSE
               EXEC CICS SPOOLWRITE
                    TOKEN(W-TOKEN)
                    FROM(W-LINE)
                    FLENGTH(OUTFILE-LENGTH)
                    RESP (W-RESP) RESP2 (W-RESP2)
               END-EXEC

               IF W-RESP NOT = 00
                   STRING 'XMITCICS: SPOOLWRITE '
                   'FAILED RESP=' W-RESP ' RESP2=' W-RESP2
                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
                   MOVE 'I' TO XMITMAIL-REPLY
                   MOVE 0 TO RETURN-CODE
                   GOBACK
               END-IF
           END-IF



           .
       CLOSE-OUTFILE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY '....  SPOOL FILE ENDS  .... '
               DISPLAY ' '
           ELSE
               EXEC CICS SPOOLCLOSE
                    TOKEN(W-TOKEN)
                    RESP (W-RESP) RESP2 (W-RESP2)
               END-EXEC
           END-IF



           .
       ALLOC-OUTFILE.
           IF XMITMAIL-DEBUG NOT = 'Y'

               CALL 'XMITGETA' USING
                   W-OUTPUT-POINTER2
                   W-OUTPUT-POINTER1

               CALL 'XMITGETA' USING
                   W-OUTPUT-STATEMENT
                   W-OUTPUT-POINTER2

               MOVE ' '
               TO W-OUTPUT-STATEMENT-PARMS
               STRING
                    ' DEST('
                    DELIMITED SIZE
                    XMITMAIL-SMTP-ADDRESS
                    DELIMITED SPACE
                    ')'
                    DELIMITED SIZE
               INTO W-OUTPUT-STATEMENT-PARMS
           END-IF



           .
       FREE-OUTFILE.
           EXIT

           .



       COPY XMITCOMM.





       IDENTIFICATION DIVISION.
       PROGRAM-ID.    XMITGETA
       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       LINKAGE SECTION.
       01  PARM1                       PIC X.
       01  PARM2                       USAGE IS POINTER.
       PROCEDURE DIVISION USING PARM1 PARM2.
           SET PARM2 TO ADDRESS OF PARM1
           GOBACK
           .
       END PROGRAM XMITGETA.




       COPY XMITINMR.




       COPY XMITMAFM.




       END PROGRAM 'XMITCICS'.
./ ADD NAME=XMITCOMM 0188-00333-10207-1002-00154-00019-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * COMMON ROUTINES USED IN XMITMAIL AND IN XMITCICS               *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 Nov 2000 1.1  written                                  AWR  *
      *                                                                *
      ******************************************************************



           .
       CALL-EXIT.
           IF XMITMAIL-CALL-EXIT = 'Y'


               MOVE 'N' TO XMITMAIL-CALL-EXIT
      *        Note: BEFORE the call - so the exit can reset it
      *        if it wants to



               IF XMITMAIL-EXIT-MOD NOT = ' '
                   CALL XMITMAIL-EXIT-MOD USING
                           XMITMAIL-CONTROL
                           XMITMAIL-DEFAULTS
                           XMITMAIL-TOS
                           XMITMAIL-CCS
                           XMITMAIL-BCCS
                           XMITMAIL-SUBJECT
                           XMITMAIL-MSGS
                   ON EXCEPTION
                   DISPLAY "XMITMAIL: EXIT PROGRAM "
                       XMITMAIL-EXIT-MOD
                       " NOT FOUND"
                   END-CALL
                   IF XMITMAIL-REPLY = 'X'
                       MOVE 0 TO RETURN-CODE
                       GOBACK
                   END-IF
               END-IF
           END-IF


           .
       WRITE-MESSAGE.

           IF XMITMAIL-SECURE = 'Y'
             MOVE 1 TO XMITINMR-CHARNO

             PERFORM XMITINMR-TOT-RECNO TIMES
                 MOVE XMITINMR-BACK(XMITINMR-CHARNO:80)
                 TO W-LINE
                 COMPUTE OUTFILE-LENGTH = 80
                 PERFORM WRITE-LINE-SECURE
                 ADD 80 TO XMITINMR-CHARNO
             END-PERFORM
           ELSE
             MOVE 1 TO XMITMAFM-CHARNO

             PERFORM UNTIL
             (XMITMAFM-CHARNO NOT < LENGTH OF XMITMAFM-BACK)  OR
             (XMITMAFM-BACK(XMITMAFM-CHARNO:40) = HIGH-VALUES)
                 MOVE XMITMAFM-BACK(XMITMAFM-CHARNO:XMITMAFM-RECL)
                 TO W-LINE
                 COMPUTE OUTFILE-LENGTH = XMITMAFM-RECL
                 PERFORM WRITE-LINE
                 ADD XMITMAFM-RECL TO XMITMAFM-CHARNO
             END-PERFORM
           END-IF


           .
       FORMAT-MESSAGE.
           CALL 'XMITMAFM' USING
                XMITMAIL-CONTROL
                XMITMAIL-DEFAULTS
                XMITMAIL-TOS
                XMITMAIL-CCS
                XMITMAIL-BCCS
                XMITMAIL-SUBJECT
                XMITMAIL-MSGS
                XMITMAFM-BACK
                XMITMAFM-RECL
                XMITMAFM-TOT-RECNO
           IF XMITMAIL-REPLY NOT = 'V'
               MOVE 0 TO RETURN-CODE
               GOBACK
           END-IF

           IF XMITMAIL-SECURE = 'Y'
                CALL 'XMITINMR' USING
               XMITMAIL-CONTROL
               XMITMAIL-DEFAULTS
               XMITMAFM-BACK
               XMITMAFM-RECL
               XMITMAFM-TOT-RECNO
               XMITINMR-BACK
               XMITINMR-TOT-RECNO
               USER-ID
               NJE-NODE

             IF XMITMAIL-REPLY NOT = 'V'
                 MOVE 0 TO RETURN-CODE
                 GOBACK
             END-IF
           END-IF







           .

./ ADD NAME=XMITDEBL 0103-10218-10218-1704-00171-00107-00068-TSO057
000100 IDENTIFICATION DIVISION.
000200
000300 PROGRAM-ID.     'XMITDEBL'.
000400
000500******************************************************************
000600*                                                                *
000700*  XMITDEBL - MODULE TO REMOVE BLANKS FROM A STRING SO THAT THE  *
000800*             RESULT HAS ONLY ONE SPACE BETWEEN WORDS            *
000900*                                                                *
001000*                   AUTHOR: AWR                                  *
001100*                                                                *
001200*             DATE WRITTEN: JUN 2007                             *
001300*                                                                *
001311*                                                                *
001312* FUNCTION - GENERAL DESCRIPTION                                 *
001313*                                                                *
001314* 1.  This module reformats a mass of text by removing all       *
001315* leading and trailing blanks and repositioning all words so     *
001316* that there is only one blank between them.                     *
001317*                                                                *
001318*                                                                *
001319* PARAMETERS                                                     *
001320*                                                                *
001321* 2.  Format:-                                                   *
001322*                                                                *
001323* (COBOL)                                                        *
001324*                                                                *
001325*     01  INPUT-TEXT              PIC X(xxxx).                   *
001326*     01  INPUT-LENGTH            PIC S9(8) COMP.                *
001327*     01  OUTPUT-TEXT             PIC X(xxxx).                   *
001328*     01  OUTPUT-LENGTH           PIC S9(8) COMP.                *
001329*     01  W-REPLY                 PIC X.                         *
001330*                                                                *
001331*         .............                                          *
001332*     MOVE ' ' TO OUTPUT-TEXT                                    *
001333*     MOVE LENGTH OF OUTPUT-TEXT TO OUTPUT-LENGTH                *
001334*                                                                *
001335*     CALL 'JTXTDEBL' USING INPUT-TEXT INPUT-LENGTH              *
001336*                          OUTPUT-TEXT OUTPUT-LENGTH             *
001337*                           W-REPLY                              *
001338*                                                                *
001339*                                                                *
001340*                                                                *
001341* 3.  The format of the parameters is:                           *
001342*                                                                *
001343*     INPUT-TEXT    the text to be formatted.  Can be any        *
001344*                   number of characters long.                   *
001345*                                                                *
001346*     INPUT-LENGTH  the length of the input text.                *
001347*                                                                *
001348*     OUTPUT-TEXT   the formatted text, set by the module.       *
001349*                                                                *
001350*     OUTPUT-LENGTH the total length of OUTPUT-TEXT.   After     *
001351*                   every call, the module replaces this by      *
001352*                   the number of characters of OUTPUT-TEXT      *
001353*                   actually returned. Therefore the calling     *
001354*                   program should reset this field before       *
001355*                   every call.                                  *
001356*                                                                *
001357*     W-REPLY       is a single character field set by the       *
001358*                   module.  Possible values :-                  *
001359*                                                                *
001360*                       'V' -  success.                          *
001361*                                                                *
001362*                       'O' -  output overflow occurred.  In     *
001363*                              this case all possible data       *
001364*                              is put in OUTPUT-TEXT             *
001365*                                                                *
001366*                   The calling program should test the          *
001367*                   reply field to make sure an 'O' error        *
001368*                   has not occurred.                            *
001369*                                                                *
001370* 4.  INPUT-TEXT can be totally blank and/or INPUT-LENGTH        *
001371*     can be 0.  In this case 'V' is returned and                *
001372*     OUTPUT-LENGTH is set to 0                                  *
001373*                                                                *
001450******************************************************************
001500
001600 ENVIRONMENT DIVISION.
001700
001710 DATA DIVISION.
001720
001730 WORKING-STORAGE SECTION.
001740
001750
001760 01  WS-FIELDS.
001770     04  INPUT-POS            PIC S9(8)      COMP.
001780     04  OUTPUT-POS           PIC S9(8)      COMP.
001790
001800 LINKAGE SECTION.
001900
002000 01  INPUT-TEXT               PIC X(32000).
002100 01  INPUT-LENGTH             PIC S9(8)      COMP.
002200
002300 01  OUTPUT-TEXT              PIC X(32000).
002400 01  OUTPUT-LENGTH            PIC S9(8)      COMP.
002500
002600
002700 01  REPLY                    PIC X.
002800
002900 PROCEDURE DIVISION USING INPUT-TEXT
003000                          INPUT-LENGTH
003100                          OUTPUT-TEXT
003200                          OUTPUT-LENGTH
003300                          REPLY.
003400
003500     IF OUTPUT-LENGTH > 0
003600         MOVE ' ' TO OUTPUT-TEXT(1:OUTPUT-LENGTH)
003700     END-IF
003800
003900     IF INPUT-LENGTH < 1
004000         MOVE 0 TO OUTPUT-LENGTH
004100         MOVE 'V' TO REPLY
004200         GOBACK
004300     END-IF
004400
004500     MOVE 1 TO INPUT-POS
004600     MOVE 0 TO OUTPUT-POS
004700
004800     PERFORM SKIP-BLANKS
004900
005000     PERFORM UNTIL INPUT-POS > INPUT-LENGTH
005100         ADD 1 TO OUTPUT-POS
005200         PERFORM MOVE-WORD
005300
005400         IF OUTPUT-POS > OUTPUT-LENGTH
005500             MOVE 'O' TO REPLY
005600             IF INPUT-POS > INPUT-LENGTH
005700                 MOVE 'V' TO REPLY
005800             END-IF
005900             GOBACK
006000         END-IF
006100
006200         IF INPUT-POS NOT > INPUT-LENGTH
006300             PERFORM SKIP-BLANKS
006400         END-IF
006500
006600     END-PERFORM
006700
006800     SUBTRACT 1 FROM OUTPUT-POS
006900     IF OUTPUT-POS < 0 MOVE 0 TO OUTPUT-POS END-IF
006910     IF OUTPUT-POS < OUTPUT-LENGTH
006920         MOVE OUTPUT-POS TO OUTPUT-LENGTH
006930     END-IF
006940
006950     MOVE 'V' TO REPLY
006960
006970     GOBACK
006980
006990
007000     .
007100 SKIP-BLANKS.
007200     PERFORM UNTIL
007300     INPUT-POS > INPUT-LENGTH
007400     OR INPUT-TEXT(INPUT-POS:1) NOT = ' '
007500         ADD 1 TO INPUT-POS
007600     END-PERFORM
007700
007800     .
007900 MOVE-WORD.
008000     PERFORM UNTIL
008100     INPUT-POS > INPUT-LENGTH
008200     OR OUTPUT-POS > OUTPUT-LENGTH
008300     OR INPUT-TEXT(INPUT-POS:1) = ' '
008400         MOVE INPUT-TEXT(INPUT-POS:1) TO OUTPUT-TEXT(OUTPUT-POS:1)
008500         ADD 1 TO INPUT-POS
008600         ADD 1 TO OUTPUT-POS
008700     END-PERFORM
008800
008900     .
009000  end program xmitdebl.
./ ADD NAME=XMITDOC  0166-00333-10222-1215-00487-00357-00000-TSO057

      ******************************************************************
      *                                                                *
      * Documentation as at 10 Aug 2010 ver 1.6                        *
      *                                                                *
      ******************************************************************


  XMITMAIL OVERVIEW
  -----------------

  1.  The callable subprogram XMITMAIL is used to generate and queue a
      simple e-mail on an OS/390 system with SMTP configured.

      XMITMAIL is designed as a "light, fast" alternative to the XMITIP
      clist created by Lionel Dyck.

      XMITMAIL is suitable for use from any batch mainline COBOL, C,
      PL/I or LE-enabled Assembler program.

      Attachments can be handled and MIME conversion is supported by
      auxillary routines but formatting must be done in the calling
      program



  2.  Each call generates a new e-mail, so many different e-mails can be
      rapidly generated in a single job step.


  3.  A similar program, XMITCICS, is provided for use under CICS.


  HOW TO USE XMITMAIL
  -------------------


 10.  Sample call format for batch:



    WORKING-STORAGE SECTION.

       01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.

       COPY XMITMAC.

       01   XMITMAIL-TOS.
            04   FILLER            PIC X(80) VALUE
            'Andy_Robertson@JohnLewis.co.uk'.
            04   FILLER            PIC X(80) VALUE
            'CTHULHU@Ryleh.com'.
            04   FILLER            PIC X(80) VALUE HIGH-VALUES.

       01   XMITMAIL-CCS.
            04   FILLER            PIC X(80) VALUE
            'AZATHOTH@TheCenterOfInfinity.com'.
            04   FILLER            PIC X(80) VALUE
            'The_Black_Goat_With_1000_Young@TheWoods.com'.
            04   FILLER            PIC X(80) VALUE HIGH-VALUES.

       01   XMITMAIL-BCCS.
            04   FILLER            PIC X(80) VALUE
            'Whatley@Dunwich.com'.
            04   FILLER            PIC X(80) VALUE
            'Wilmarth@Miskatonic_U.edu'.
            04   FILLER            PIC X(80) VALUE HIGH-VALUES.

       01   XMITMAIL-SUBJECT       PIC X(80) VALUE
            'Test E-mail   '.

       01   XMITMAIL-MSGS.
            04   FILLER            PIC X(80) VALUE
            'Whoop-de-do !!        '.
            04   FILLER            PIC X(80) VALUE
            'The stars just came right!!'.
            04   FILLER            PIC X(80) VALUE HIGH-VALUES.


        . . . . . .

        . . . . . .


    PROCEDURE DIVISION.

        . . . . . .

        . . . . . .


         CALL XMITMAIL-NAME USING
             XMITMAIL-CONTROL
             XMITMAIL-TOS
             XMITMAIL-CCS
             XMITMAIL-BCCS
             XMITMAIL-SUBJECT
             XMITMAIL-MSGS


        . . . . . .

        . . . . . .




 11. The parameters are:

       XMITMAIL-CONTROL  In copybook XMITMAC, a control block containing
                       various control fields.   See below for details.

                       You must include the XMITMAIL library in the
                       SYSLIB concatenation when you compile any calling
                       program, so that the copybook XMITMAC will be
                       picked up.


       XMITMAIL-TOS    A series of e-mail addressees (padded to 80
                       bytes) for To:  recepients.

                       This list of 80-byte addressees must be
                       terminated by an 80-byte line all high-values.
                       There must be at least one To:  addressee.


       XMITMAIL-CCS    A series of e-mail addressees (padded to 80
                       bytes) for Carbon Copy.

                       This list of 80-byte addressees must be
                       terminated by an 80-byte line of all high-values.
                       There may be zero addressees i.e.  the first or
                       only line may be blank or high-values.


       XMITMAIL-BCCS   A series of e-mail addressees (padded to 80
                       bytes) for Blank Carbon Copy.

                       This list of 80-byte addressees must be
                       terminated by an 80-byte line of all high-values.
                       There may be zero addressees i.e.  the first or
                       only line may be blank or high-values.


       XMITMAIL-SUBJECT An 80 bytes Subject for the e-mail


       XMITMAIL-MSGS   The message text.  A series of 80-byte lines.
                       Terminated by an 80-byte line of high-values.
                       The line length of the MSGS may be adjusted by
                       changing the control field XMITMAIL-LINE-LENGTH,
                       see below.


 12. Sub-fields within XMITMAIL-CONTROL are:

     XMITMAIL-REPLY          A one-byte flag indicating the success or
                             failure of the subprogram call:

                             V  -  all OK
                             E  -  undefined error
                             I  -  I/O error
                             L  -  line length invalid
                             N  -  error in dynamic allocation
                             O  -  internal buffer overflow
                             A  -  invalid e-mail address
                             X  -  rejected by exit subprogram
                             P  -  invalid PROCESS-OPTION
                             M  -  Max number e-mails sent exceeded


     XMITMAIL-PROCESS-OPTION Process option "1" is for plain text and is
                             the default. XMITMAIL creates all envelope
                             headers up to the Subject: header and
                             then inserts a blank line.  You simply pass
                             a series of plain text message lines.

                             Process option "2" indicates that you want
                             to add more headers. The data you supply
                             must include any Mime-Version header and
                             all subsequent parts of the mail envelope.
                             This is the only way to send multi-part
                             e-mails using XMITMAIL

                             See sample programs XMITIVP2, XMITIVP4,
                             XMITIVP7


     XMITMAIL-DEBUG          set to 'Y' to have the mail DISPLAYed
                             not written to the spool


     XMITMAIL-FROM           you may place an e-mail address here to
                             specify who the e-mail is From:  If you
                             leave it blank the value from
                             XMITMAIL-FROM-DEFAULT in XMITMADF is used,
                             or, if XMITMAIL-FROM-DEFAULT is blank, no
                             From: is generated.


     XMITMAIL-RECEIPT        you may place an e-mail address here to
                             specify who the e-mail Return-Receipt-to:
                             is set to.  If you leave it blank a
                             Return-Receipt-to: is not generated.


     XMITMAIL-REPLYTO        you may place an e-mail address here to
                             specify who the e-mail Reply-to: is set to.
                             If you leave it blank a Reply-to: is not
                             generated and replies will go to the From:
                             address.


     XMITMAIL-LINE-LENGTH    The length of lines within XMITMAIL-MSG.
                             The XMITMAC copybook defines this as 80,
                             but you may change it at any time.  Range
                             is 10 to 255.


     XMITMAIL-MAX-MAILS      The maximum number of e-mails that may be
                             sent in a batch run.

                             This is a safeguard against looping
                             programs which may flood the spool with
                             e-mails.  Default is 999. 0 means no
                             limit


     XMITMAIL-DIAGNOSTIC     An 80-byte IEHIBALL diagnostic that
                             explains errors.



   XMITIP OR XMITMAIL?
   --------------------


 20.  Use XMITIP if you need to send attachments, or if you want to send
      a one-off e-mail.

 21.  Use XMITMAIL if you have a mainline program running as a regular
      batch process, and you need to generate many different simple
      e-mails from it under program control.

 22.  If you want to send e-mails from CICS, use XMITCICS

 23.  XMITMAIL works under ISPF the same as in batch.




   PERFORMANCE?
   ------------

 30.  XMITMAIL will require about 1/10 the CPU resource XMITIP needs to
      format a simple e-mail and queue it on the JES spool.

      On our system (MIPS about 150) XMITIP took about 0.15 seconds CPU
      per simple message, XMITMAIL about 0.017 seconds CPU

     (The e-mail will not actually be sent until the SMTP started task
      takes it off the JES spool and transmits it.  The CPU requirement
      for this will of course be the same for XMITIP and XMITMAIL).

 31.  XMITMAIL is limited to 4000 records of 80 bytes each or a total
      size 320,000 bytes.  This may be changed by changing the value
      in the XMITSIZE copybook before installation.

 32.  XMITCICS is limited to 360 records of 80 bytes each or a total
      size 28,800 bytes. This can not be increased because it is limited
      by the 32K COMMAREA restriction.



   BUGS, SUGGESTIONS, ETC.
   ----------------------

 40.  Contact


          Andy_Robertson@JohnLewis.co.uk


 41.  WHAT WILL NOT BE DONE

          - support for non-LE sites. If you haven't got LE in by now,
            here is another reason to buck up.

          - sophisticated attachment support.  If you need attachments
            you may format the mail-envelope yourself using
            PROCESS-OPTION 2 and the auxilary subroutines supplied with
            this software (see later).


  HOW TO USE XMITCICS
  -------------------


 50.  XMITCICS repackages XMITMAIL code for CICS. It accesses the spool
      using EXEC CICS SPOOL..... commands not the dynamic allocate
      commands used by XMITMAIL in batch.

      XMITCICS can be EXEC CICS LINKed to under CICS.

      Your e-mail must be placed inside a standard copybook XMITMACC,
      which should be the COMMAREA for the EXEC CICS LINK.

      XMITCICC includes all the control fields detailed in 12) above as
      well as the XMITMAIL-TO, XMITMAIL-CC, XMITMAIL-BCC and
      XMITMAIL-MSG fields.  You are limited to ten addressees of each
      type (To: Cc: and Bcc:) and to 360 lines of message.

      See XMITIVP3 for a sample CICS program that calls XMITCICS

      You do not need to add a DDNAME to CICS to make XMITCICS work


 51.  Sample call format:


       WORKING-STORAGE SECTION.

       01   XMITCICS-COMM-AREA.
         COPY XMITMACC.

        . . . . . .

        . . . . . .


       PROCEDURE DIVISION.

        . . . . . .

        . . . . . .


           MOVE  'Andy_Robertson@JohnLewis.co.uk'
             TO  XMITMAIL-TO(1)
           MOVE  HIGH-VALUES
             TO  XMITMAIL-TO(2)

           MOVE  HIGH-VALUES
             TO  XMITMAIL-CC(1)

           MOVE  HIGH-VALUES
             TO  XMITMAIL-BCC(1)

           MOVE  'Test e-mail'
             TO  XMITMAIL-SUBJECT

           MOVE  'Hi there'
             TO  XMITMAIL-MSG(1)
           MOVE  ' '
             TO  XMITMAIL-MSG(2)
           MOVE  'This is a test e-mail'
             TO  XMITMAIL-MSG(3)
           MOVE  HIGH-VALUES
             TO  XMITMAIL-MSG(4)

      ********* SECURE MODE ONLY
           MOVE  'MC1'
             TO  XMITMAIL-NJE-NODE

           EXEC CICS LINK
                PROGRAM('XMITCICS')
                COMMAREA(XMITCICS-COMM-AREA)
           END-EXEC

        . . . . . .

        . . . . . .







  HOW TO INSTALL
  --------------


 60.  Prerequisites:

      o  OS/390, any level, or z/OS, any level.

      o  Language Environment, any level.  XMITMAIL may work without
         LE run time but I do not have facilities to test it.

      o  SMTP properly configured

      o  COBOL II or later

      o  CICS 4.1 or later (using LE) for XMITCICS.  I am pretty sure
         XMITCICS will NOT work without LE.


 61.  To install XMITMAIL and XMITCICS

      o  The XMITMAIL library is in unzipped TSO XMIT format.  It is
         available from:

              http://www.thenightland.co.uk/MYWEB/mvsindex.html

         Follow the instructions at that site to download it, FTP or
         SEND it to your mainframe as a binary file and TSO RECEIVE it
         into a PDS.

      o  Examine member XMITDOC (this member) for any updates

      o  Customise the defaults in XMITMADF according to the comments
         within that copybook

      o  If 320,000 bytes is likely to be too small modify XMITSIZE.

      o  Customise and run the job XMITINST. This will put XMITMAIL and
         XMITCICS in load libraries, which you must, as usual,  include
         in STEPLIB/LINKLIST for batch jobs, or DFHRPL for CICS.
         Note, compile with NOSSRANGE.

      o  Create exit subprogram(s) if you need them.  See XMITMADF for a
         description of what an exit subprogram does. See XMITEXIT for a
         sample exit program.

         Compile an exit program using the XMITINSX job.

         Place the exits in STEPLIB/LINKLIB or in DFHRPL.  ** NOTE **
         this exit program is accessed through COBOL dynamic call.  This
         DOES WORK under CICS - provided you have LE.


 62.  Optionally

      o  You may compile and run XMITIVP1/2/3 . . .   if the fancy takes
         you These programs are described by comments within them. They
         demonstrate standard use, use under CICS, HTML, and
         attachments.

      o  AT your discretion compile the auxillary formatting routines
         XMITFMT and XMITDEBL to object code. These are designed to
         handle masses of text and help you reformat it to fit e-mail
         lines.  You may find them useful in other contexts.  For detail
         of use see comments inline in the source code.

      o  AT your discretion compile the auxillary attachment routines
         XMIT64, XMITCHAR, XMITMIME and XMITBND to object code.

             XMIT64 converts data to 64-bit mime format;

             XMITCHAR converts data from 64-bit mime format;

             XMITMIME takes a binary object and creates records to
             transmit it in 64-bit mime format, ready for use by
             XMITMAIL.

             XMITBND creates a separator.

         These are for use with process-option 2 and their use is
         demonstrated in XMITIVPx. THEY HAVE NOT BEEN COMPREHENSIVELY
         TESTED.

         Note, compile with NOSSRANGE.

      o  You may wish to use the sample XMITSMS program for sending
         short messages.  You will need to customise the message
         destination to the email-to-SMS gateway you use.




  SECURE MODE
  -----------


 80.  if you are running SMTP in SECURE mode you must set the
      XMITMAIL-SECURE flag in XMITMADF to Y before running XMITINST.

 81.  You must also put your local NJE node in the XMITMAIL-NJE-NODE
      field whenever you invoke XMITCICS.

      If you omit this the node will be derived from the used or
      defaulted FROM address eg if XMITMAIL-FROM is
      TSO057@IPO.tiffani.co.uk then node will be IPO.

      The node is not needed in batch.  Nor is it needed if you are not
      running in SECURE mode.
./ ADD NAME=XMITEXIT 0110-00329-05074-1516-00077-00066-00000-TSO057
      ******************************************************************
      *                                                                *
      * SAMPLE EXIT ROUTINE                                            *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                  AWR  *
      *                                                                *
      ******************************************************************

      ******************************************************************
      *                                                                *
      * Note.  This module is dynamically called.  Dynamic call DOES   *
      * work under CICS & is fully supported.  To run an exit          *
      * module like this under CICS, simply compile & link to a        *
      * DFHRPL library WITHOUT translation.                            *
      *                                                                *
      ******************************************************************


       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITEXIT'.
       DATA DIVISION.
       ENVIRONMENT DIVISION.
       WORKING-STORAGE SECTION.

       LINKAGE SECTION.

       COPY XMITMAC.

       COPY XMITMADF.

       01   XMITMAIL-TOS.
            04   XMITMAIL-TO       PIC X(80) OCCURS 100.

       01   XMITMAIL-CCS.
            04   XMITMAIL-CC       PIC X(80) OCCURS 100.

       01   XMITMAIL-BCCS.
            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.

       01   XMITMAIL-SUBJECT       PIC X(80).

       01   XMITMAIL-MSGS.
            04   XMITMAIL-MSG      PIC X(80)
                   copy xmitsize.


       PROCEDURE DIVISION USING
            XMITMAIL-CONTROL
            XMITMAIL-DEFAULTS
            XMITMAIL-TOS
            XMITMAIL-CCS
            XMITMAIL-BCCS
            XMITMAIL-SUBJECT
            XMITMAIL-MSGS
            .

      *    Daft test

           IF XMITMAIL-TO (1) (1:1) = 'B'
               MOVE 'X' TO XMITMAIL-REPLY
               MOVE ' You cant call people with names starting "B"'
               TO XMITMAIL-DIAGNOSTIC
           END-IF


      *    Make sure we are called again for the next e-mail

           MOVE 'Y' TO XMITMAIL-CALL-EXIT

           GOBACK.
./ ADD NAME=XMITFMT  0103-10218-10218-1703-00346-00271-00080-TSO057
000100 identification division.
000200
000300 PROGRAM-ID.     'XMITFMT'.
000400
000500******************************************************************
000600*                                                                *
000700*  XMITFMT - MODULE TO REFORMAT TEXT SO THAT IT CAN BE DISPLAYED *
000800*            WITHOUT WORDS BEING SPLIT ACROSS LINES.             *
000900*                                                                *
001000*                   AUTHOR: GARY HIRD                            *
001100*                                                                *
001200*             DATE WRITTEN: MAY 1990                             *
001300*                                                                *
001310*                                                                *
001320*  FUNCTION - GENERAL DESCRIPTION                                *
001321*                                                                *
001322*  1.  This module reformats a mass of text into a number of     *
001323*  fixed-length lines in such a way that words (assumed          *
001324*  delimited by blanks) are not split between the lines, and     *
001325*  there are no leading blanks in any lines                      *
001326*                                                                *
001327*                                                                *
001328*  PARAMETERS                                                    *
001329*                                                                *
001330*  2.  Format:-                                                  *
001331*                                                                *
001332*  (COBOL)                                                       *
001333*                                                                *
001334*      01  INPUT-TEXT              PIC X(xxxx).                  *
001335*      01  INPUT-LENGTH            PIC S9(8) COMP.               *
001336*      01  OUTPUT-LINES.                                         *
001337*          04  OUTPUT-LINE         PIC X(yyyy) OCCURS(zz).       *
001338*      01  OUTPUT-LENGTH           PIC S9(8) COMP.               *
001339*      01  OUTPUT-LINE-LENGTH      PIC S9(8) COMP value yyyy.    *
001340*      01  W-REPLY                 PIC X.                        *
001341*                                                                *
001342*          .............                                         *
001343*      MOVE ' ' TO OUTPUT-LINES                                  *
001344*      MOVE LENGTH OF OUTPUT-LINES TO OUTPUT-LENGTH              *
001345*                                                                *
001346*      CALL 'XMITFMT' USING INPUT-TEXT INPUT-LENGTH              *
001347*                           OUTPUT-LINES OUTPUT-LENGTH           *
001348*                           OUTPUT-LINE-LENGTH W-REPLY           *
001349*                                                                *
001350*                                                                *
001351*                                                                *
001352*  3.  The format of the parameters is:                          *
001353*                                                                *
001354*      INPUT-TEXT    the text to be formatted.  Can be up to     *
001355*                    320000 characters long.                     *
001356*                                                                *
001357*      INPUT-LENGTH  the length of the input text.               *
001358*                                                                *
001359*      OUTPUT-LINES  the formatted text, set by the module.      *
001360*                    Can be up to 320000 characters long.        *
001361*                                                                *
001362*      OUTPUT-LENGTH the total length of OUTPUT-LINES.           *
001363*                    After every call, the module replaces       *
001364*                    this by the number of characters of         *
001365*                    OUTPUT-LINES actually used. Therefore       *
001366*                    the calling program should reset this       *
001367*                    field before every call.                    *
001368*                                                                *
001369*      OUTPUT-LINE-LENGTH  the output line length.  This         *
001370*                    field does NOT have to be an exact          *
001371*                    fraction of OUTPUT-LENGTH.                  *
001372*                                                                *
001373*      W-REPLY       is a single character field set by the module
001374*                    Possible values :-                          *
001375*                                                                *
001376*                        'V' -  success.                         *
001377*                                                                *
001378*                        'O' -  output overflow occurred.        *
001379*                                                                *
001380*                        'S' -  the line length given is too     *
001381*                               small, being less than the       *
001382*                               length of at least one of        *
001383*                               the words in the text.           *
001384*                                                                *
001385*                    The calling program should test the reply   *
001386*                    field to make sure an 'O' or 'S' error has  *
001387*                    not occurred.                               *
001388*                                                                *
001389*                                                                *
001390*                                                                *
001451*                                                                *
001452*                                                                *
001460******************************************************************
001500*                                                                *
001600*  MODIFICATION HISTORY:                                         *
001700*                                                                *
001710*  14/12/00  AWR     MOD TO ELIMINATE BLANKS AT START OF NEW     *
001720*                    LINE                                        *
001730*                                                                *
001740******************************************************************
001750
001760 ENVIRONMENT DIVISION.
001770
001780 data division.
001790
001800 working-storage section.
001900
002000
002100 01  ws-fields.
002200     04  current-word         pic x(320000).
002300     04  work-out-lineno      pic s9(8)      comp.
002400     04  w-prevchar           pic s9(8)      comp.
002500     04  w-dummy1             pic s9(8)      comp.
002600     04  w-dummy2             pic s9(8)      comp.
002700     04  position-in-word     pic s9(8)      comp.
002800     04  position-in-input    pic s9(8)      comp.
002900     04  position-in-output   pic s9(8)      comp.
003000     04  position-in-block    pic s9(8)      comp.
003100     04  space-left-in-block  pic s9(8)      comp.
003200     04  word-length          pic s9(8)      comp.
003300     04  reply-flag           pic X.
003400        88 end-of-input              value 'V'.
003500        88 output-overflow           value 'O'.
003600        88 block-length-too-small    value 'S'.
003700
003800 linkage section.
003900
004000 01  input-text               pic x(320000).
004100 01  input-length             pic s9(8)      comp.
004200
004300 01  output-text              pic x(320000).
004400 01  output-length            pic s9(8)      comp.
004500
004600 01  block-length             pic s9(8)      comp.
004700
004800 01  reply                    pic x.
004900
005000 procedure division using input-text  input-length
005100                          output-text output-length
005200                          block-length reply.
005300
005400******************************************************************
005500*                                                                *
005600*  Start of mainline.                                            *
005700*                                                                *
005800******************************************************************
005900
006000     perform b100-initialization
006100     perform b400-deal-with-spaces
006200
006300     perform until end-of-input or output-overflow
006400                            or block-length-too-small
006500         perform b200-get-next-word
006600         perform b300-move-word-to-output
006700         perform b400-deal-with-spaces
006800     end-perform
006900
007000     perform b500-finalization
007100
007200     goback
007300******************************************************************
007400*                                                                *
007500*  End of mainline.                                              *
007600*                                                                *
007700******************************************************************
007800
007900
008000     .
008100 b100-initialization.
008200******************************************************************
008300*                                                                *
008400*  Initialize pointers, etc.                                     *
008500*                                                                *
008600******************************************************************
008700
008800     move spaces to current-word output-text(1:output-length)
008900                                 reply-flag
009000     move zero to   position-in-block  position-in-output
009100     move +1   to   position-in-input
009200
009300     .
009400 b200-get-next-word.
009500******************************************************************
009600*                                                                *
009700*  Get next word.                                                *
009800*                                                                *
009900******************************************************************
010000
010100     move zero to position-in-word
010200     perform until input-text(position-in-input:1) = space
010300                    or position-in-input > input-length
010400         add +1 to position-in-word
010500         move input-text(position-in-input:1)
010600           to current-word(position-in-word:1)
010700         add +1 to position-in-input
010800     end-perform
010900
011000     move position-in-word to word-length
011100
011200     if position-in-input not < input-length
011300         set end-of-input to true
011400     end-if
011500
011600     .
011700 b300-move-word-to-output.
011800******************************************************************
011900*                                                                *
012000*  Check word length.                                            *
012100*                                                                *
012200******************************************************************
012300
012400     move zero to position-in-word
012500     subtract position-in-block from block-length
012600                       giving space-left-in-block
012700
012800     if space-left-in-block < word-length
012900
013000         if word-length > block-length
013100
013200             set block-length-too-small to true
013300         else
013400*            display "=1>" current-word(1:word-length)
013500             perform until position-in-block = block-length
013600                       or output-overflow
013700                 add +1 to position-in-block position-in-output
013800                 perform c100-check-for-overflow
013900                 move space to output-text (position-in-output:1)
014000             end-perform
014100
014200             move zero to position-in-block
014300
014400             perform until position-in-word = word-length
014500                       or output-overflow
014600                 add +1 to position-in-block position-in-output
014700                           position-in-word
014800                 perform c100-check-for-overflow
014900                 move current-word (position-in-word:1)
015000                   to output-text (position-in-output:1)
015100             end-perform
015200
015300         end-if
015400
015500     else
015600***transfer word and continue
015700*        display "=2>" current-word(1:word-length)
015800         perform until position-in-word = word-length
015900                       or output-overflow
016000             add +1 to position-in-block position-in-output
016100                       position-in-word
016200             perform c100-check-for-overflow
016300             move current-word (position-in-word:1)
016400               to output-text (position-in-output:1)
016500         end-perform
016600
016700     end-if
016800
016900     .
017000 b400-deal-with-spaces.
017100******************************************************************
017200*                                                                *
017300*  Deal with spaces between words                                *
017400*                                                                *
017500******************************************************************
017600
017700     perform until input-text(position-in-input:1) not = space
017800                    or position-in-input > input-length
017900                    or output-overflow
018000         add +1 to position-in-output position-in-block
018100         if position-in-block > block-length
018200             move +1 to position-in-block
018300         end-if
018400         perform c100-check-for-overflow
018500         move input-text(position-in-input:1)
018600           to output-text(position-in-output:1)
018700         add +1 to position-in-input
018800     end-perform
018900
019000******************************************************************
019100*                                                                *
019200*  Deal with case where initial char of an output line,          *
019300*  following this word, is blank                                 *
019400*                                                                *
019500*  If it is second or subsequent output line, eliminate the      *
019600*  blank.                                                        *
019700*                                                                *
019800******************************************************************
019900
020000     if not (position-in-input > input-length
020100                    or output-overflow)
020200
020300         compute w-prevchar = (position-in-output)
020400         compute work-out-lineno = (w-prevchar) / block-length
020500
020600         if work-out-lineno > 0
020700
020800             divide w-prevchar by block-length
020900             giving w-dummy1 remainder w-dummy2
021000
021100*            display "       " w-prevchar
021200*            display "       " w-dummy1
021300*            display "       " w-dummy2
021400*            display "       " position-in-block
021500
021600             if w-dummy2 = 1
021700                 if output-text(w-prevchar:1) = ' '
021800
021900                     subtract 1 from position-in-output
022000                     subtract 1 from position-in-block
022100
022200                 end-if
022300             end-if
022400         end-if
022500     end-if
022600*
022700*                                                                *
022800*                                                                *
022900
023000
023100
023200
023300     if position-in-input not < input-length
023400         set end-of-input to true
023500     end-if
023600
023700     .
023800 b500-finalization.
023900******************************************************************
024000*                                                                *
024100*  End processing - set reply flag, etc.                         *
024200*                                                                *
024300******************************************************************
024400
024500     if not output-overflow
024600         move position-in-output to output-length
024700     end-if
024800     move reply-flag to reply
024900
025000     .
025100 c100-check-for-overflow.
025200******************************************************************
025300*                                                                *
025400*  Check for overflow.                                           *
025500*                                                                *
025600******************************************************************
025700
025800     if position-in-output not < output-length
025900         set output-overflow to true
026000     end-if
026100
026200     .
026300  end program xmitfmt.
./ ADD NAME=XMITINMR 0116-10201-10222-1202-00326-00604-00000-TSO057


      ************************************************************
      *   XMITINMR batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      ************************************************************


       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITINMR'.

      ******************************************************************
      *                                                                *
      * CONVERT FROM AN FB INCORE FILE OF ARBITRARY LRECL AND LENGTH   *
      * TO A FILE IN TSO TRANSMIT FORMAT, ALSO INCORE                  *
      *                                                                *
      ***
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 JUL 2010 1.6  SECURE mode spport  - NEW PROGRAM        AWR  *
      *                                                                *
      ******************************************************************

       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.

       01   INMR-LEN-X.
            04   INMR-LEN           PIC S9(8) COMP.
       01   W-LEN-X.
            04   W-LEN         PIC S9(8) COMP.
       01   XMITINMR-CHAR-X.
            04   XMITINMR-CHAR PIC S9(8) COMP.
       01   XMITMAFM-REC-X.
            04   XMITMAFM-REC  PIC S9(8) COMP.
       01   W-T-DATA PIC X(255).

       01   INMR01.
           04 INMR01-LEN-X          PIC X.
           04 INMR01-SEG            PIC X VALUE X'E0'.
           04 INMR01-ID             PIC XXXXXX VALUE 'INMR01'.
           04 INMR01-T1.
              07 INMR01-T1-KEY      PIC XX VALUE X'0042'.
              07 INMR01-T1-NO       PIC XX VALUE X'0001'.
              07 INMR01-T1-LEN      PIC XX VALUE X'0001'.
              07 INMR01-T1-RECL     PIC X.
           04 INMR01-REST           PIC X(7777).


       01   INMR02.
           04 INMR02-LEN-X          PIC X.
           04 INMR02-SEG            PIC X VALUE X'E0'.
           04 INMR02-ID             PIC XXXXXX VALUE 'INMR02'.
           04 INMR02-T0.
              07 INMR02-T0-KEY      PIC XX VALUE X'0000'.
              07 INMR02-T0-NO       PIC XX VALUE X'0001'.
           04 INMR02-T1.
              07 INMR02-T1-KEY      PIC XX VALUE X'1028'.
              07 INMR02-T1-NO       PIC XX VALUE X'0001'.
              07 INMR02-T1-LEN      PIC XX VALUE X'0007'.
              07 INMR02-T1-UTIL     PIC XXXXXXX VALUE 'INMCOPY'.
           04 INMR02-T2.
              07 INMR02-T2-KEY      PIC XX VALUE X'102C'.
              07 INMR02-T2-NO       PIC XX VALUE X'0001'.
              07 INMR02-T2-LEN      PIC XX VALUE X'0004'.
              07 INMR02-T2-BYTES-X  PIC XXXX.
           04 INMR02-T3.
              07 INMR02-T3-KEY      PIC XX VALUE X'003C'.
              07 INMR02-T3-NO       PIC XX VALUE X'0001'.
              07 INMR02-T3-LEN      PIC XX VALUE X'0002'.
              07 INMR02-T3-DSORG    PIC XX VALUE X'4000'.
           04 INMR02-T4.
              07 INMR02-T4-KEY      PIC XX VALUE X'0042'.
              07 INMR02-T4-NO       PIC XX VALUE X'0001'.
              07 INMR02-T4-LEN      PIC XX VALUE X'0004'.
              07 INMR02-T4-RECL-X   PIC XXXX VALUE X'000000FF'.
           04 INMR02-T5.
              07 INMR02-T5-KEY      PIC XX VALUE X'0030'.
              07 INMR02-T5-NO       PIC XX VALUE X'0001'.
              07 INMR02-T5-LEN      PIC XX VALUE X'0004'.
              07 INMR02-T5-BLOCK-X  PIC XXXX VALUE X'00001000'.
           04 INMR02-T6.
              07 INMR02-T6-KEY      PIC XX VALUE X'0049'.
              07 INMR02-T6-NO       PIC XX VALUE X'0001'.
              07 INMR02-T6-LEN      PIC XX VALUE X'0002'.
              07 INMR02-T6-RECFM    PIC XX VALUE X'5002'.
           04 INMR02-T7.
              07 INMR02-T7-KEY      PIC XX VALUE X'0002'.
              07 INMR02-T7-NO       PIC XX VALUE X'0005'.
              07 INMR02-T7-LEN1     PIC XX VALUE X'0004'.
              07 INMR02-T7-QUAL1    PIC X(4) VALUE 'SENT'.
              07 INMR02-T7-LEN2     PIC XX VALUE X'0008'.
              07 INMR02-T7-QUAL2    PIC X(8) VALUE 'XMITMAIL'.
              07 INMR02-T7-LEN3     PIC XX VALUE X'0007'.
              07 INMR02-T7-QUAL3    PIC X(7) VALUE 'DYYMMDD'.
              07 INMR02-T7-LEN4     PIC XX VALUE X'0007'.
              07 INMR02-T7-QUAL4    PIC X(7) VALUE 'HHHMMSS'.
              07 INMR02-T7-LEN5     PIC XX VALUE X'0003'.
              07 INMR02-T7-QUAL5    PIC XXX VALUE 'XTH'.




       01   INMR03.
           04 INMR03-LEN-X          PIC X.
           04 INMR03-SEG            PIC X VALUE X'E0'.
           04 INMR03-ID             PIC XXXXXX VALUE 'INMR03'.
           04 INMR03-T1.
              07 INMR03-T1-KEY      PIC XX VALUE X'102C'.
              07 INMR03-T1-NO       PIC XX VALUE X'0001'.
              07 INMR03-T1-LEN      PIC XX VALUE X'0004'.
              07 INMR03-T1-SIZEBYTE PIC XXXX.
           04 INMR03-T2.
              07 INMR03-T2-KEY      PIC XX VALUE X'003C'.
              07 INMR03-T2-NO       PIC XX VALUE X'0001'.
              07 INMR03-T2-LEN      PIC XX VALUE X'0002'.
              07 INMR03-T2-DSORG    PIC XX VALUE X'4000'.
           04 INMR03-T3.
              07 INMR03-T3-KEY      PIC XX VALUE X'0042'.
              07 INMR03-T3-NO       PIC XX VALUE X'0001'.
              07 INMR03-T3-LEN      PIC XX VALUE X'0002'.
              07 INMR03-T3-RECL     PIC XX VALUE X'0050'.
           04 INMR03-T4.
              07 INMR03-T4-KEY      PIC XX VALUE X'0049'.
              07 INMR03-T4-NO       PIC XX VALUE X'0001'.
              07 INMR03-T4-LEN      PIC XX VALUE X'0002'.
              07 INMR03-T4-RECFM    PIC XX VALUE X'0001'.



       01   INMR06.
           04 INMR06-LEN-X          PIC X VALUE X'08'.
           04 INMR06-SEG            PIC X VALUE X'E0'.
           04 INMR06-ID             PIC XXXXXX VALUE 'INMR06'.


       LINKAGE SECTION.

       COPY XMITMAC.

       COPY XMITMADF.

       01   T.
          04  T-KEY PIC XX.
          04  T-NO   PIC XX.
          04  T-LEN-X.
             07  T-LEN PIC 9999 COMP.
          04  T-DATA PIC X(777).

       01   XMITMAFM-BACK.
            04   FILLER            PIC X(800).
            04   XMITMAIL-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.

       01   XMITMAFM-RECL         PIC S9(8) COMP.
       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.

       01   XMITINMR-BACK.
            04   FILLER            PIC X(800).
            04   XMITINMR-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.
       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.
       01   USER-ID               PIC XXXXXXXX.
       01   NJE-NODE              PIC XXXXXXXX.

       PROCEDURE DIVISION USING
            XMITMAIL-CONTROL
            XMITMAIL-DEFAULTS
            XMITMAFM-BACK
            XMITMAFM-RECL
            XMITMAFM-TOT-RECNO
            XMITINMR-BACK
            XMITINMR-TOT-RECNO
            USER-ID
            NJE-NODE

             .
           MOVE 'E' TO XMITMAIL-REPLY

           COMPUTE W-LEN = XMITMAFM-RECL
           MOVE W-LEN-X(4:1) TO INMR01-T1-RECL
           SET ADDRESS OF T TO ADDRESS OF INMR01-REST
           COMPUTE INMR-LEN = LENGTH OF INMR01-T1
                            + 8
   ******  DISPLAY 'INMR-LEN ' INMR-LEN
           MOVE X'1011' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE NJE-NODE        TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA

           MOVE X'1012' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE USER-ID         TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA

           MOVE X'1001' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE XMITMAIL-CENTER TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA

           MOVE X'1002' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE XMITMAIL-SMTP-ADDRESS TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA

           MOVE X'1024' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE FUNCTION CURRENT-DATE (1:14)
           TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA

           MOVE X'102F' TO T-KEY
           MOVE X'0001' TO T-NO
           MOVE X'01'
           TO W-T-DATA
           PERFORM MOVEIN-01-T-DATA
           MOVE INMR-LEN-X(4:1) TO INMR01-LEN-X

           MOVE FUNCTION CURRENT-DATE (03:06)
           TO INMR02-T7-QUAL3(2:6)

           MOVE FUNCTION CURRENT-DATE (09:06)
           TO INMR02-T7-QUAL4(2:6)

           MOVE FUNCTION CURRENT-DATE (15:02)
           TO INMR02-T7-QUAL5(2:2)

           MOVE LENGTH OF INMR02 TO W-LEN
           MOVE W-LEN-X(4:1) TO INMR02-LEN-X


           COMPUTE W-LEN = XMITMAFM-RECL *
                           XMITMAFM-TOT-RECNO
           MOVE W-LEN-X TO INMR03-T1-SIZEBYTE
           MOVE W-LEN-X TO INMR02-T2-BYTES-X

           MOVE LENGTH OF INMR03 TO W-LEN
           MOVE W-LEN-X(4:1) TO INMR03-LEN-X


           MOVE 1 TO XMITINMR-CHAR

           MOVE 0 TO W-LEN
           MOVE INMR01-LEN-X TO W-LEN-X(4:1)
           MOVE INMR01(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)
           ADD W-LEN TO XMITINMR-CHAR

           MOVE 0 TO W-LEN
           MOVE INMR02-LEN-X TO W-LEN-X(4:1)
           MOVE INMR02(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)
           ADD W-LEN TO XMITINMR-CHAR

           MOVE 0 TO W-LEN
           MOVE INMR03-LEN-X TO W-LEN-X(4:1)
           MOVE INMR03(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)
           ADD W-LEN TO XMITINMR-CHAR

           MOVE 1 TO XMITMAFM-REC

           PERFORM UNTIL XMITMAFM-REC > XMITMAFM-TOT-RECNO
               COMPUTE W-LEN = 2 + XMITMAFM-RECL
               MOVE W-LEN-X(4:1) TO XMITINMR-BACK(XMITINMR-CHAR:1)
               ADD 1 TO XMITINMR-CHAR
               MOVE X'C0' TO XMITINMR-BACK(XMITINMR-CHAR:1)
               ADD 1 TO XMITINMR-CHAR
               COMPUTE W-LEN = 1 + (XMITMAFM-REC - 1) * XMITMAFM-RECL
               MOVE XMITMAFM-BACK(W-LEN:XMITMAFM-RECL)
               TO   XMITINMR-BACK(XMITINMR-CHAR:XMITMAFM-RECL)
               ADD 1 TO XMITMAFM-REC
               ADD XMITMAFM-RECL TO XMITINMR-CHAR
           END-PERFORM


           MOVE 0 TO W-LEN
           MOVE INMR06-LEN-X TO W-LEN-X(4:1)
           MOVE INMR06(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)
           ADD W-LEN TO XMITINMR-CHAR
           MOVE ' '             TO XMITINMR-BACK(XMITINMR-CHAR:180)
           ADD 80   TO XMITINMR-CHAR
           COMPUTE XMITINMR-TOT-RECNO = XMITINMR-CHAR / 80
           MOVE 'V' TO XMITMAIL-REPLY
           GOBACK

           .
       MOVEIN-01-T-DATA.
           MOVE 1 TO W-LEN
           PERFORM UNTIL W-LEN NOT < LENGTH OF W-T-DATA
           OR W-T-DATA(W-LEN:1) = ' '
               ADD 1 TO W-LEN
           END-PERFORM
           SUBTRACT 1 FROM W-LEN
           IF W-LEN > 0 MOVE W-T-DATA(1:W-LEN) TO T-DATA(1:W-LEN)
           MOVE W-LEN TO T-LEN
           COMPUTE INMR-LEN = INMR-LEN + T-LEN + 6
   *****   display 'data     ' W-T-DATA(1:W-LEN)
   *****   display 'inmr-len ' inmr-len
           ADD 1 TO W-LEN
           SET ADDRESS OF T TO ADDRESS OF T-DATA(W-LEN:1)
           MOVE ' ' TO W-T-DATA


           .
       END PROGRAM XMITINMR.
./ ADD NAME=XMITINST 0134-00329-10210-1525-00185-00063-00000-TSO057
//TSO05765 JOB (T951V00),
//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A,SCHENV=COBOL
//*
//******************************************************************
//*                                                                *
//*  This job will compile and link XMITMAIL and XMITCICS into     *
//*  load libraries                                                *
//*                                                                *
//*  Run after you have customised the XMITMADF member             *
//*                                                                *
//******************************************************************
//*
//******************************************************************
//* HISTORY                                                        *
//******************************************************************
//*                                                                *
//* 22 Nov 2000 1.0  written                                  AWR  *
//* 26 Nov 2000 1.1  XMITCICS added                           AWR  *
//* 26 Jul 2010 1.6  XMITUID and XMITNODE (assembler)         AWR  *
//*                                                                *
//******************************************************************
//*
//*
//*
//*      TO RUN THIS JOB
//*      ---------------
//*
//*
//*  1) CHANGE THE JOBCARD
//*
//*
//*  2) CHANGE THE NAMES OF:
//*
//*        PP.XMITMA16.COBOL  - to the XMITMAIL library
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITMAIL to be stored
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITCICS to be stored
//*
//*        SYS1.SYSLEV. libraries - as appropriate
//*
//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate
//*
//*
//*   3) ADD COMPILER STEPLIBS IF NEEDED, ETC ETC
//*
//*
//*   4) CHECK YOU HAVE CUSTOMISED XMITMADF
//*
//*
//*   5) SUBMIT JOB
//*
//*
//* Expect RC 4
//*
//ASM      PROC  M=
//ASM    EXEC PGM=ASMA90,PARM=(OBJ,NODECK)
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//SYSIN    DD  DSN=PP.XMITMA16.COBOL(&M),DISP=SHR
//SYSUT1   DD  DSN=&&SYSUT1,UNIT=VIO,SPACE=(9999,(600,100))
//SYSUT2   DD  DSN=&&SYSUT2,UNIT=VIO,SPACE=(1700,(300,50))
//SYSUT3   DD  DSN=&&SYSUT3,UNIT=VIO,SPACE=(1700,(300,50))
//SYSPRINT DD  SYSOUT=*,DCB=BLKSIZE=1089
//SYSPUNCH DD  SYSOUT=B
//SYSLIN   DD  DSN=&&ASMOBJ(&M),UNIT=SYSALLDA,SPACE=(80,(200,50,70)),
//             DISP=(MOD,PASS)
//         PEND
//*
//       EXEC ASM,M=XMITNODE
//       EXEC ASM,M=XMITUID
//*
//*   ******************************************************************
//*   *                                                                *
//*   *       BATCH MODULE                                             *
//*   *                                                                *
//*   ******************************************************************
//*
//*
//C        EXEC PGM=IGYCRCTL,COND=(4,LT),
// PARM=('NOOFFSET,SSRANGE,RENT,NOCICS',
//       'NODYNAM,LIB,APOST,')
//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSPRINT DD   SYSOUT=*
//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL
//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITMAIL),DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,
//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))
//*
//* PRE-LINKEDIT STEP:
//*
//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),
// PARM=''
//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR
//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),
//             SPACE=(32000,(30,30)),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)
//SYSOUT   DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)
//         DD  *
//SYSLIB   DD  DUMMY
//*
//* LINKEDIT
//*
//LINK     EXEC PGM=HEWL,COND=(4,LT),
// PARM=('XREF,LIST,MAP',
// 'AMODE=31,RMODE=ANY,REUS,RENT')
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))
//SYSPRINT DD   SYSOUT=*
//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITMAIL),DISP=SHR
//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U
//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR
//         DD   DSN=&&ASMOBJ,DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)
//*
//*
//*
//*
//*   ******************************************************************
//*   *                                                                *
//*   *        CICS MODULE                                             *
//*   *                                                                *
//*   ******************************************************************
//*
//*
//* STANDARD CICS TRANSLATE
//*
//T        EXEC  PGM=DFHECP1$,COND=(4,LT),
// PARM='LINECOUNT(56),NOSOURCE,NOXREF,APOST,COBOL2'
//STEPLIB  DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR
//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLPA,DISP=SHR
//SYSPRINT DD   SYSOUT=*
//SYSPUNCH DD   DSN=&&SOURCE,
//           DISP=(NEW,PASS),
//           BLKSIZE=3120,
//           UNIT=SYSALLDA,SPACE=(400,(400,100))
//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITCICS),DISP=SHR
//*
//* COBOL COMPILE
//*
//*
//C        EXEC PGM=IGYCRCTL,COND=(4,LT),
// PARM=('NOOFFSET,NOSSRANGE,RENT,NOCICS,LIST',
//       'NODYNAM,LIB,APOST,')
//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,
//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))
//SYSPRINT DD   SYSOUT=*
//SYSLIB  DD    DISP=SHR,DSN=PP.XMITMA16.COBOL
//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHCOB,DISP=SHR
//         DD   DSN=SYS1.SYSLEV.ACEESRC1,DISP=SHR
//SYSIN    DD   DSN=&SOURCE,DISP=(SHR,DELETE)
//*
//* LINKEDIT
//*
//LINK     EXEC PGM=HEWL,COND=(4,LT),
// PARM=('XREF,LIST,MAP',
// 'RENT,REUS,AMODE=31,RMODE=ANY')
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))
//SYSPRINT DD   SYSOUT=*
//SYSLIN   DD   *
   INCLUDE CICSLINK(DFHELII)
//         DD   DSN=&&OBJ,DISP=(OLD,DELETE)
//CICSLINK DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR
//SYSLIB   DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR
//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR
//         DD   DSN=&&ASMOBJ,DISP=SHR
//SYSLMOD  DD   DSN=PP.XMITMA16.LOAD(XMITCICS),DISP=SHR
./ ADD NAME=XMITINSX 0106-00336-10217-2314-00152-00149-00000-TSO057
//TSO05765 JOB (T951V00),
//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A
//*
//******************************************************************
//*                                                                *
//*  This job will compile and link XMITEXIT into                  *
//*  batch and CICS load libraries                                 *
//*                                                                *
//*  Run only if you need an exit program                          *
//*                                                                *
//******************************************************************
//*
//******************************************************************
//* HISTORY                                                        *
//******************************************************************
//*                                                                *
//* 26 Nov 2000 1.1  written                                  AWR  *
//*                                                                *
//******************************************************************
//*
//*
//*
//*      TO RUN THIS JOB
//*      ---------------
//*
//*
//*  0) Modify XMITEXIT to do what you want
//*
//*
//*  1) CHANGE THE JOBCARD
//*
//*
//*  2) CHANGE THE NAMES OF:
//*
//*        SFT.XMITMAIL.COBOL - to the XMITMAIL library
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITEXIT to be stored for batch jobs
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITEXIT to be stored for CICS
//*
//*        SYS1.SYSLEV. libraries - as appropriate
//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate
//*
//*
//*   3) ADD STEPLIBS IF NEEDED, ETC ETC
//*
//*
//*   4) SUBMIT JOB
//*
//*
//* expect RC 4
//*
//*
//*
//*   ******************************************************************
//*   *                                                                *
//*   *       BATCH EXIT MODULE                                        *
//*   *                                                                *
//*   ******************************************************************
//*
//*
//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,
// PARM=('NOOFFSET,NOSSRANGE,RENT',
//       'NODYNAM,LIB,APOST,')
//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS330.SIGYCOMP
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSPRINT DD   SYSOUT=*
//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL
//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITEXIT),DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,
//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))
//*
//* PRE-LINKEDIT STEP:
//*
//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),REGION=7M,
// PARM=''
//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR
//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),
//             SPACE=(32000,(30,30)),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)
//SYSOUT   DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)
//         DD  *
//SYSLIB   DD  DUMMY
//*
//* LINKEDIT
//*
//LINK     EXEC PGM=HEWL,COND=(4,LT),
// PARM=('XREF,LIST,MAP',
// 'AMODE=31,RMODE=ANY,REUS,RENT')
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))
//SYSPRINT DD   SYSOUT=*
//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITEXIT),DISP=SHR
//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U
//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)
//*
//*
//*
//*   ******************************************************************
//*   *                                                                *
//*   *        CICS EXIT MODULE                                        *
//*   *                                                                *
//*   ******************************************************************
//*
//*
//*
//* COBOL COMPILE.  Note no precompile
//*
//*
//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,
// PARM=('NOOFFSET,NOSSRANGE,RENT,LIST',
//       'NODYNAM,LIB,APOST,')
//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS330.SIGYCOMP
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,
//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))
//SYSPRINT DD   SYSOUT=*
//SYSLIB  DD    DISP=SHR,DSN=PP.XMITMA16.COBOL
//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHCOB,DISP=SHR
//         DD   DSN=SYS1.SYSLEV.ACEESRC1,DISP=SHR
//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITEXIT),DISP=SHR
//*
//* LINKEDIT
//*
//LINK     EXEC PGM=HEWL,COND=(4,LT),
// PARM=('XREF,LIST,MAP',
// 'RENT,REUS,AMODE=31,RMODE=ANY')
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))
//SYSPRINT DD   SYSOUT=*
//SYSLIN   DD   *
   INCLUDE CICSLINK(DFHELII)
//         DD   DSN=&&OBJ,DISP=(OLD,DELETE)
//CICSLINK DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR
//SYSLIB   DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR
//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR
//SYSLMOD  DD   DSN=PP.XMITMA16.LOAD(XMITEXIT),DISP=SHR
./ ADD NAME=XMITIVPH 0102-05343-10210-1506-00155-00150-00006-TSO057
000001 CBL NOSSRANGE
000002******************************************************************
000003*                                                                *
000004* XMITIVPH.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *
000005*            FORMATTED MULTIPART E-MAIL, AND HTML                *
000006*                                                                *
000007******************************************************************
000008
000009******************************************************************
000010* HISTORY                                                        *
000020******************************************************************
000030*                                                                *
000040* 10 Dec 2005 1.2  New                                      AWR  *
000050*                                                                *
000060******************************************************************
000070
000080 IDENTIFICATION DIVISION.
000090 PROGRAM-ID.
000091         XMITIVPH .
000092
000093 ENVIRONMENT DIVISION.
000094 DATA DIVISION.
000095 WORKING-STORAGE SECTION.
000096
000097
000098
000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
000100
000200    COPY XMITMAC.
000300
000400    01   XMITMAIL-TOS.
000500         04   FILLER            PIC X(80) VALUE
000600         'Andy_Robertson@JohnLewis.co.uk'.
000700         04   FILLER            PIC X(80) VALUE
000800         'pinlighter@btconnect.com'.
000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001000
001100    01   XMITMAIL-CCS.
001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001300
001400    01   XMITMAIL-BCCS.
001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001600
001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
001800         'IVP  E-mail format html '.
001900
002000    01   XMITMAIL-MSG.
002100         04   MSG-LINE          PIC X(80)
002200         OCCURS 999 INDEXED BY LINE-NO.
002300
002400
002500
002600
002700
002800    01   Q    PIC X     VALUE '"'.
002900
003000    01   BND  PIC X(37) VALUE
003010             'Mime.Part.XMITIP.24jul65lrhg.0x0zax1d'.
003020
003030
003040
003050 PROCEDURE DIVISION.
003060
003070
003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION
003090
003100     call 'xmitbnd' using bnd
003200
003300
003400     SET LINE-NO TO 1
003500
003600     MOVE 'Mime-Version: 1.0 '
003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003800
003900     MOVE ' ' to MSG-LINE(LINE-NO)
004000     STRING  'Content-type: multipart/mixed; boundary='
004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)
004200             SET LINE-NO UP BY 1
004300
004400     MOVE ' '
004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004600
004700     MOVE 'This is a multi-part message in MIME format. '
004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004900
005000     MOVE ' ' TO MSG-LINE(LINE-NO)
005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
005200     SET LINE-NO UP BY 1
005300
005400*    HTML
005500
005600
005700     MOVE 'Content-Type: text/html; charset="iso-8859-1"'
005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005900
006000     MOVE 'Content-Transfer-Encoding: 7bit '
006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006200
006300     MOVE ' '
006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006500
006600     MOVE ' '
006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006800
006810*** Actual html starts here
006820
006900     MOVE '<HTML><BODY><PRE>                            '
007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007100
007200     MOVE ' one two <b>three</b> four'
007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007400
007410     MOVE '     <H1> Header</h1>     '
007420     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007430
007440     MOVE    '         '
007450     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007460
007470     MOVE    'last line'
007480     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007490     MOVE    '</pre>'
007500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007600
007610*** Actual html ends here
007620
007630
007700     MOVE ' '  TO MSG-LINE(LINE-NO)
007800     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
007900     SET LINE-NO UP BY 1
008000
008100
008200
008300
008400
008410     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)
008420
008430      CALL XMITMAIL-NAME USING
008440          XMITMAIL-CONTROL
008450          XMITMAIL-TOS
008460          XMITMAIL-CCS
008470          XMITMAIL-BCCS
008480          XMITMAIL-SUBJECT
008490          XMITMAIL-MSG
008500
008600
008700
008800     DISPLAY XMITMAIL-CONTROL
008900     DISPLAY XMITMAIL-DIAGNOSTIC
009000
009100
009200     STOP RUN.
009300
009400 copy xmitbnd .
009500 END PROGRAM XMITIVPH.
009600
./ ADD NAME=XMITIVPR 0100-10204-10204-1631-00095-00095-00000-TSO057
//TSO05765 JOB (T951V00),
//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A,SCHENV=COBOL
//*
//*
//*
//*      TO RUN THIS JOB
//*      ---------------
//*
//*
//*  1) CHANGE THE JOBCARD
//*
//*
//*  2) CHANGE THE NAMES OF:
//*
//*        PP.XMITMA16.COBOL - to the XMITMAIL library
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITMAIL to be stored
//*
//*        PP.XMITMA16.LOAD   - to the load library where you want
//*                             XMITCICS to be stored
//*
//*        SYS1.SYSLEV. libraries - as appropriate
//*
//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate
//*
//*
//*   3) ADD COMPILER STEPLIBS IF NEEDED, ETC ETC
//*
//*
//*   4) CHECK YOU HAVE CUSTOMISED XMITMADF
//*
//*
//*   5) SUBMIT JOB
//*
//*
//* Expect RC 4
//*
//*
//*
//*   ******************************************************************
//*   *                                                                *
//*   *       BATCH MODULE                                             *
//*   *                                                                *
//*   ******************************************************************
//*
//*
//C        EXEC PGM=IGYCRCTL,COND=(4,LT),
// PARM=('NOOFFSET,SSRANGE,RENT,NOCICS',
//       'NODYNAM,LIB,APOST,')
//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)
//SYSPRINT DD   SYSOUT=*
//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL
//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITIVP1),DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,
//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))
//*
//* PRE-LINKEDIT STEP:
//*
//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),
// PARM=''
//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR
//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),
//             SPACE=(32000,(30,30)),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)
//SYSOUT   DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)
//         DD  *
//SYSLIB   DD  DUMMY
//*
//* LINKEDIT
//*
//LINK     EXEC PGM=HEWL,COND=(4,LT),
// PARM=('XREF,LIST,MAP',
// 'AMODE=31,RMODE=ANY,REUS,RENT')
//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))
//SYSPRINT DD   SYSOUT=*
//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITIVP1),DISP=SHR
//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U
//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR
//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)
//*
//*
//   EXEC PGM=XMITIVP1
//STEPLIB  DD DSN=PP.XMITMA16.LOAD,DISP=SHR
//SYSOUT   DD   SYSOUT=*
//*
./ ADD NAME=XMITIVP1 0109-00341-10210-1506-00087-00069-00025-TSO057
000001 CBL NOSSRANGE
000010******************************************************************
000020*                                                                *
000030* XMITIVP1.  DEMONSTRATES CALL USING PROCESS-OPTION 1, PLAIN-    *
000040*            TEXT                                                *
000050*                                                                *
000060******************************************************************
000070
000080******************************************************************
000090* HISTORY                                                        *
000091******************************************************************
000092*                                                                *
000093* 06 Dec 2000 1.2  New                                      AWR  *
000094*                                                                *
000095******************************************************************
000096
000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300         XMITIVP1 .
000400
000500 ENVIRONMENT DIVISION.
000600 DATA DIVISION.
000700 WORKING-STORAGE SECTION.
000800
000900
001000
001100    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
001200
001300    COPY XMITMAC.
001400
001500    01   XMITMAIL-TOS.
001600         04   FILLER            PIC X(80) VALUE
001700         'Andy_Robertson@JohnLewis.co.uk'.
001800         04   FILLER            PIC X(80) VALUE
001900         'pinlighter@btconnect.com'.
002000*        04   FILLER            PIC X(80) VALUE
002100*        'CTHULHU@Ryleh.com'.
002200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
002300
002400    01   XMITMAIL-CCS.
002500*        04   FILLER            PIC X(80) VALUE
002600*        'AZATHOTH@TheCenterOfInfinity.com'.
002700*        04   FILLER            PIC X(80) VALUE
002800*        'The_Black_Goat_With_1000_Young@TheWoods.com'.
002900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
003000
003100    01   XMITMAIL-BCCS.
003200*        04   FILLER            PIC X(80) VALUE
003300*        'Whatley@Dunwich.com'.
003400*        04   FILLER            PIC X(80) VALUE
003500*        'Wilmarth@Miskatonic_U.edu'.
003600         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
003700
003800    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
003900         'IVP e-mail format 1   '.
004000
004100    01   XMITMAIL-MSGS.
004200         04   FILLER            PIC X(80) VALUE
004300         'Whoop-de-do.          '.
004400         04   FILLER            PIC X(80) VALUE
004500         'The stars just came right!!'.
004600         04   FILLER            PIC X(80) VALUE
004610         '. Full.  stop!!!             '.
004620         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
004700
004800
004900 PROCEDURE DIVISION.
005000
005100
005200*    MOVE 'Y' TO XMITMAIL-DEBUG
005300
005400      CALL XMITMAIL-NAME USING
005500          XMITMAIL-CONTROL
005600          XMITMAIL-TOS
005700          XMITMAIL-CCS
005800          XMITMAIL-BCCS
005900          XMITMAIL-SUBJECT
006000          XMITMAIL-MSGS
006100
006200
006300
006400     DISPLAY XMITMAIL-CONTROL
006500     DISPLAY XMITMAIL-DIAGNOSTIC
006600     IF XMITMAIL-REPLY NOT = 'V' MOVE 16 TO RETURN-CODE
006700     END-IF
006800     STOP RUN.
006900
./ ADD NAME=XMITIVP2 0114-00341-10210-1506-00179-00109-00179-TSO057
000001 CBL NOSSRANGE
000010******************************************************************
000020*                                                                *
000030* XMITIVP2.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *
000040*            FORMATTED MULTIPART E-MAIL, AND TEXT ATTACHMENT     *
000051*                                                                *
000052******************************************************************
000053
000054******************************************************************
000055* HISTORY                                                        *
000056******************************************************************
000057*                                                                *
000058* 01 Mar 2000 1.2  New                                      AWR  *
000059*                                                                *
000060******************************************************************
000070
000080 IDENTIFICATION DIVISION.
000090 PROGRAM-ID.
000091         XMITIVP2 .
000092
000093 ENVIRONMENT DIVISION.
000094 DATA DIVISION.
000095 WORKING-STORAGE SECTION.
000096
000097
000098
000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
000100
000200    COPY XMITMAC.
000300
000400    01   XMITMAIL-TOS.
000500         04   FILLER            PIC X(80) VALUE
000600         'Andy_Robertson@JohnLewis.co.uk'.
000700         04   FILLER            PIC X(80) VALUE
000800         'pinlighter@btconnect.com'.
000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001000
001100    01   XMITMAIL-CCS.
001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001300
001400    01   XMITMAIL-BCCS.
001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001600
001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
001800         'IVP  E-mail format 2  + binary attachment '.
001900
002000    01   XMITMAIL-MSG.
002100         04   MSG-LINE          PIC X(80)
002200         OCCURS 999 INDEXED BY LINE-NO.
002300
002400
002500
002600
002700
002800    01   Q    PIC X     VALUE '"'.
002900
003000    01   BND  PIC X(37) VALUE
003010             'Mime.Part.XMITIP.24jul65lrhg.0x0zax1d'.
003020
003030
003040
003050 PROCEDURE DIVISION.
003060
003070
003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION
003090
003100     call 'xmitbnd' using bnd
003200
003300
003400     SET LINE-NO TO 1
003500
003600     MOVE 'Mime-Version: 1.0 '
003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003800
003900     MOVE ' ' to MSG-LINE(LINE-NO)
004000     STRING  'Content-type: multipart/mixed; boundary='
004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)
004200             SET LINE-NO UP BY 1
004300
004400     MOVE ' '
004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004600
004700     MOVE 'This is a multi-part message in MIME format. '
004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004900
005000     MOVE ' ' TO MSG-LINE(LINE-NO)
005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
005200     SET LINE-NO UP BY 1
005300
005400*    Plain text
005500
005600
005700     MOVE 'Content-Type: text/plain; charset="iso-8859-1"'
005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005900
006000     MOVE 'Content-Transfer-Encoding: 7bit '
006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006200
006300     MOVE ' '
006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006500
006600     MOVE ' '
006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006800
006900     MOVE '.line1   - initial period -                  '
007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007100
007200     MOVE 'line 2'
007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007400
007500     MOVE    'last line'
007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007700
007800     MOVE ' '  TO MSG-LINE(LINE-NO)
007900     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
008000     SET LINE-NO UP BY 1
008100
008200
008300*    text attachment
008400
008410
008420     MOVE 'Content-Type: text/plain; '
008430     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008440
008441     MOVE '              name="testtext"'
008442     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008443
008444     MOVE 'Content-Transfer-Encoding: 7bit '
008445     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008446
008447     MOVE 'Content-Disposition: attachment;             '
008448     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008449
008450     MOVE '   filename="test.txt"                       '
008451     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008452
008453     MOVE 'Content-Description: f                       '
008454     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008455
008456     MOVE ' '
008457     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008458
008459     MOVE 'file line 1                                  '
008460     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008470
008471     MOVE 'file line 2                                  '
008472     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008473
008474     MOVE 'file last line                               '
008475     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
008476
008477     MOVE ' ' to MSG-LINE(LINE-NO)
008478     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
008479     SET LINE-NO UP BY 1
008480
008481
008482
008483
008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)
008485
008486      CALL XMITMAIL-NAME USING
008487          XMITMAIL-CONTROL
008488          XMITMAIL-TOS
008489          XMITMAIL-CCS
008490          XMITMAIL-BCCS
008500          XMITMAIL-SUBJECT
008600          XMITMAIL-MSG
008700
008800
008900
009000     DISPLAY XMITMAIL-CONTROL
009100     DISPLAY XMITMAIL-DIAGNOSTIC
009200
009300
009400     STOP RUN.
009500
009600 copy xmitbnd .
009610 end program xmitivp2.
009700
./ ADD NAME=XMITIVP3 0105-00364-10210-1506-00084-00076-00012-TSO057
000001 CBL NOSSRANGE
000010******************************************************************
000020*                                                                *
000030* XMITIVP3.  Demonstrates XMITCICS under CICS                    *
000050*                                                                *
000051*            Must be translated, compiled and linked as is       *
000052*            usual for a CICS program                            *
000053*                                                                *
000060******************************************************************
000070
000080******************************************************************
000090* HISTORY                                                        *
000091******************************************************************
000092*                                                                *
000093* 29 Dec 2000 1.2  New                                      AWR  *
000094*                                                                *
000095******************************************************************
000096
000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300         XMITIVP3 .
000400
000500 ENVIRONMENT DIVISION.
000600 DATA DIVISION.
000700 WORKING-STORAGE SECTION.
000800
000810
000820 01   XMITCICS-COMM-AREA.
000830   COPY XMITMACC.
000840
000850
000860 LINKAGE SECTION.
000870
000880
000890 PROCEDURE DIVISION.
000900
001600
001700     MOVE  'Andy_Robertson@JohnLewis.co.uk'
001800       TO  XMITMAIL-TO(1)
001900
001910     move  'pinlighter@btconnect.com'
001920       TO  XMITMAIL-TO(2)
001930
002000     MOVE  HIGH-VALUES
002100       TO  XMITMAIL-TO(3)
002200
002300
002400     MOVE  HIGH-VALUES
002500       TO  XMITMAIL-CC(1)
002600
002700
002800     MOVE  HIGH-VALUES
002900       TO  XMITMAIL-BCC(1)
003000
003100********* SECURE MODE ONLY
003110     MOVE  'MC1'
003120       TO  XMITMAIL-NJE-NODE
003130
003140
003200     MOVE  'Test e-mail'
003300       TO  XMITMAIL-SUBJECT
003400
003500
003600     MOVE  'Hi there'
003700       TO  XMITMAIL-MSG(1)
003800
003900     MOVE  ' '
004000       TO  XMITMAIL-MSG(2)
004100
004200     MOVE  'This is a test e-mail'
004300       TO  XMITMAIL-MSG(3)
004400
004500     MOVE  HIGH-VALUES
004600       TO  XMITMAIL-MSG(4)
004700
004800
004900
005000     EXEC CICS LINK
005100          PROGRAM('XMITCICS')
005200          COMMAREA(XMITCICS-COMM-AREA)
005300     END-EXEC
005600
005700     STOP RUN.
005800
./ ADD NAME=XMITIVP4 0121-05060-10210-1507-00167-00130-00167-TSO057
000001 CBL NOSSRANGE
000002******************************************************************
000003*                                                                *
000004* XMITIVP4.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *
000005*            FORMATTED MULTIPART E-MAIL, AND SENDS BINARY DATA   *
000006*            IN 64 BIT MIME FORMAT USING XMIT64 AND XMITMIME     *
000007*                                                                *
000008******************************************************************
000009
000010******************************************************************
000020* HISTORY                                                        *
000030******************************************************************
000040*                                                                *
000050* 01 Mar 2005 1.5  New                                      AWR  *
000051*                                                                *
000052******************************************************************
000053
000054 IDENTIFICATION DIVISION.
000055 PROGRAM-ID.
000056         XMITIVP4 .
000057
000058 ENVIRONMENT DIVISION.
000059 DATA DIVISION.
000060 WORKING-STORAGE SECTION.
000070
000080
000090
000091    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
000092
000093    COPY XMITMAC.
000094
000095    01   XMITMAIL-TOS.
000096         04   FILLER            PIC X(80) VALUE
000097         'Andy_Robertson@JohnLewis.co.uk'.
000098         04   FILLER            PIC X(80) VALUE
000099         'pinlighter@btconnect.com'.
000100         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
000200
000300    01   XMITMAIL-CCS.
000400         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
000500
000600    01   XMITMAIL-BCCS.
000700         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
000800
000900    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
001000         'IVP  E-mail format 2  + binary attachment '.
001100
001200    01   XMITMAIL-MSG.
001300         04   MSG-LINE          PIC X(80)
001400         OCCURS 999 INDEXED BY LINE-NO.
001500
001600
001700
001800
001900
002000
002100    01   Q    PIC X     VALUE '"'.
002200
002300    01   BND  PIC X(37).
002400
002500    01   binary-object-name pic x(80) value 'sample.bin'.
002600
002700    01   binary-object  pic x(565) value all
002800*        'a'.
002900         'abcdABCE5678&%¢"77*(){}{]£]]+++=====)00pp'.
003000
003010    01   LINES-ADDED    PIC S9(8) COMP.
003020
003030
003040
003050
003051 PROCEDURE DIVISION.
003052
003053
003054     MOVE '2' TO XMITMAIL-PROCESS-OPTION
003055
003056     CALL 'XMITBND' using bnd
003057
003058     SET LINE-NO TO 1
003059
003060     MOVE 'Mime-Version: 1.0 '
003070     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003080
003090     MOVE ' ' to MSG-LINE(LINE-NO)
003100     STRING  'Content-type: multipart/mixed; boundary='
003200     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)
003300             SET LINE-NO UP BY 1
003400
003500     MOVE ' '
003600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003700
003800     MOVE 'This is a multi-part message in MIME format. '
003900     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004000
004100     MOVE ' ' TO MSG-LINE(LINE-NO)
004200     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
004300     SET LINE-NO UP BY 1
004400
004500*    Plain text
004600
004700
004800     MOVE 'Content-Type: text/plain; charset="iso-8859-1"'
004900     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005000
005100     MOVE 'Content-Transfer-Encoding: 7bit '
005200     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005300
005400     MOVE ' '
005500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005600
005700     MOVE ' '
005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005900
006000     MOVE '.line1   - initial period -                  '
006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006200
006300     MOVE 'line 2'
006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006500
006600     MOVE 'last line'
006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006800
006900     MOVE ' '  TO MSG-LINE(LINE-NO)
007000     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
007100     SET LINE-NO UP BY 1
007200
007300
007400*    binary attachment
007500
007600     CALL 'XMITMIME' USING
007700         BY REFERENCE XMITMAIL-CONTROL
007800         BY REFERENCE MSG-LINE(LINE-NO)
007900         BY REFERENCE BINARY-OBJECT-NAME
008000         BY REFERENCE BND
008100         BY REFERENCE BINARY-OBJECT
008200         BY CONTENT LENGTH OF BINARY-OBJECT
008300         BY REFERENCE LINES-ADDED
008400
008410     IF XMITMAIL-REPLY NOT = 'V' GOBACK END-IF
008420     SET LINE-NO UP BY LINES-ADDED
008430
008440*    all done
008450
008460
008470     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)
008480
008490      CALL XMITMAIL-NAME USING
008500          XMITMAIL-CONTROL
008510          XMITMAIL-TOS
008520          XMITMAIL-CCS
008530          XMITMAIL-BCCS
008540          XMITMAIL-SUBJECT
008550          XMITMAIL-MSG
008560
008570
008580
008590     DISPLAY XMITMAIL-CONTROL
008600     DISPLAY XMITMAIL-DIAGNOSTIC
008700
008800
008900     STOP RUN.
009000
009100
009200 copy xmitbnd.
009300 copy xmitmime.
009400
009500 end program xmitivp4.
./ ADD NAME=XMITIVP5 0101-05074-10210-1507-00151-00151-00001-TSO057
000001 CBL NOSSRANGE
000002******************************************************************
000003*                                                                *
000004* XMITIVP5.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *
000005*            FORMATTED MULTIPART E-MAIL, AND HTML ATTACHMENT     *
000006*                                                                *
000007******************************************************************
000008
000009******************************************************************
000010* HISTORY                                                        *
000020******************************************************************
000030*                                                                *
000040* 11 Mar 2000 1.5  New                                      AWR  *
000050*                                                                *
000060******************************************************************
000070
000080 IDENTIFICATION DIVISION.
000090 PROGRAM-ID.
000091        'XMITIVP5'.
000092
000093 ENVIRONMENT DIVISION.
000094 DATA DIVISION.
000095 WORKING-STORAGE SECTION.
000096
000097
000098
000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
000100
000200    COPY XMITMAC.
000300
000400    01   XMITMAIL-TOS.
000500         04   FILLER            PIC X(80) VALUE
000600         'Andy_Robertson@JohnLewis.co.uk'.
000700         04   FILLER            PIC X(80) VALUE
000800         'PINLIGHTER@BTCONNECT.COM'.
000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001000
001100    01   XMITMAIL-CCS.
001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001300
001400    01   XMITMAIL-BCCS.
001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001600
001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
001800         'IVP  E-mail format 2  + html attachment '.
001900
002000    01   XMITMAIL-MSG.
002100         04   MSG-LINE          PIC X(80)
002200         OCCURS 999 INDEXED BY LINE-NO.
002300
002400
002500
002600
002700
002800    01   Q    PIC X     VALUE '"'.
002900
003000    01   BND  PIC X(37).
003020
003030
003040
003050 PROCEDURE DIVISION.
003060
003070
003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION
003090
003100     call 'xmitbnd' using bnd
003200
003300
003400     SET LINE-NO TO 1
003500
003600     MOVE 'Mime-Version: 1.0 '
003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003800
003900     MOVE ' ' to MSG-LINE(LINE-NO)
004000     STRING  'Content-type: multipart/mixed; boundary='
004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)
004200             SET LINE-NO UP BY 1
004300
004400     MOVE ' '
004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004600
004700     MOVE 'This is a multi-part message in MIME format. '
004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
004900
005000     MOVE ' ' TO MSG-LINE(LINE-NO)
005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
005200     SET LINE-NO UP BY 1
005300
005400*    HTml
005500
005600
005700     MOVE 'Content-Type: text/html; charset="iso-8859-1"'
005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
005900
006000     MOVE 'Content-Transfer-Encoding: 7bit '
006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006200
006300     MOVE ' '
006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006500
006600     MOVE ' '
006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006800
006900     MOVE '<font face="Courier" size="+2" color=blue>   '
007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007100
007200     MOVE 'Blue  Line of text'
007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007400
007500     MOVE    '</font><br> '
007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007700
007710
007720     MOVE '<font face="ariel" size="+1" color=red>   '
007730     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007740
007750     MOVE 'Red  Line of text'
007760     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007770
007780     MOVE    '</font><br> '
007790     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007791
007792
007800     MOVE ' '  TO MSG-LINE(LINE-NO)
007900     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)
008000     SET LINE-NO UP BY 1
008100
008200
008482
008483
008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)
008485
008486      CALL XMITMAIL-NAME USING
008487          XMITMAIL-CONTROL
008488          XMITMAIL-TOS
008489          XMITMAIL-CCS
008490          XMITMAIL-BCCS
008500          XMITMAIL-SUBJECT
008600          XMITMAIL-MSG
008700
008800
008900
009000     DISPLAY XMITMAIL-CONTROL
009100     DISPLAY XMITMAIL-DIAGNOSTIC
009200
009300
009400     STOP RUN.
009500
009600 copy xmitbnd .
009610 end program 'xmitivp5'.
009620
./ ADD NAME=XMITIVP7 0102-07142-10210-1507-00110-00110-00002-TSO057
000001 CBL NOSSRANGE
000002******************************************************************
000003*                                                                *
000004* XMITIVP7.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *
000005*            FORMATTED E-MAIL, PLAIN TEXT, WITH                  *
000006*            IMPORTANCE:                                         *
000007*                                                                *
000008******************************************************************
000009
000010******************************************************************
000011* HISTORY                                                        *
000020******************************************************************
000030*                                                                *
000040* 01 Mar 2000 1.2  New                                      AWR  *
000050*                                                                *
000060******************************************************************
000070
000080 IDENTIFICATION DIVISION.
000090 PROGRAM-ID.
000091         XMITIVP7 .
000092
000093 ENVIRONMENT DIVISION.
000094 DATA DIVISION.
000095 WORKING-STORAGE SECTION.
000096
000097
000098
000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.
000100
000200    COPY XMITMAC.
000300
000400    01   XMITMAIL-TOS.
000500         04   FILLER            PIC X(80) VALUE
000600         'Andy_Robertson@JohnLewis.co.uk'.
000700         04   FILLER            PIC X(80) VALUE
000800         'PINLIGHTER@BTCONNECT.COM'.
000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001000
001100    01   XMITMAIL-CCS.
001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001300
001400    01   XMITMAIL-BCCS.
001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.
001600
001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE
001800         'IVP  E-mail format 2   '.
001900
002000    01   XMITMAIL-MSG.
002100         04   MSG-LINE          PIC X(80)
002200         OCCURS 999 INDEXED BY LINE-NO.
002300
002400
002500
002600
002700
003040
003050 PROCEDURE DIVISION.
003060
003070
003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION
003090
003200
003300
003400     SET LINE-NO TO 1
003500
003600     MOVE 'Importance: High'
003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
003800
005300
005400*    Plain text so just end with a blank line
005500
005600
006300     MOVE ' '
006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
006500
006800
006810
006820
006830***** message starts here
006840
006850
006900     MOVE 'line1   - initial line   -                  '
007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007100
007200     MOVE 'line 2'
007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007400
007500     MOVE    'last line'
007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1
007700
008482
008483
008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)
008485
008486      CALL XMITMAIL-NAME USING
008487          XMITMAIL-CONTROL
008488          XMITMAIL-TOS
008489          XMITMAIL-CCS
008490          XMITMAIL-BCCS
008500          XMITMAIL-SUBJECT
008600          XMITMAIL-MSG
008700
008800
008900
009000     DISPLAY XMITMAIL-CONTROL
009100     DISPLAY XMITMAIL-DIAGNOSTIC
009200
009300
009400     STOP RUN.
009500
./ ADD NAME=XMITMAC  0120-00328-02060-1221-00054-00025-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      *          CONTROL BLOCK FOR CALLING XMITMAIL                    *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                  AWR  *
      * 26 Nov 2000 1.1  details moved to XMITMACF                AWR  *
      *                                                                *
      ******************************************************************



       01 XMITMAIL-CONTROL.

            COPY XMITMACF.

./ ADD NAME=XMITMACC 0113-00332-10203-1855-00073-00064-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      *          COMMAREA FOR LINK TO XMITCICS                         *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 Nov 2000 1.1  written                                  AWR  *
      *                                                                *
      ******************************************************************


        02   XMITMAIL-CONTROL.
            COPY XMITMACF.


        02   XMITMAIL-TOS               PIC X(880) VALUE HIGH-VALUES.
        02   FILLER REDEFINES XMITMAIL-TOS.
            04   XMITMAIL-TO       PIC X(80) OCCURS 10.
            04   XMITMAIL-TO-BUF   PIC X(80).

        02   XMITMAIL-CCS               PIC X(880) VALUE HIGH-VALUES.
        02   FILLER REDEFINES XMITMAIL-CCS.
            04   XMITMAIL-CC       PIC X(80) OCCURS 10.
            04   XMITMAIL-CC-BUF   PIC X(80).

        02   XMITMAIL-BCCS              PIC X(880) VALUE HIGH-VALUES.
        02   FILLER REDEFINES XMITMAIL-BCCS.
            04   XMITMAIL-BCC      PIC X(80) OCCURS 10.
            04   XMITMAIL-BCC-BUF  PIC X(80).


        02   XMITMAIL-SUBJECT       PIC X(80) VALUE ' '.

        02   XMITMAIL-MSGS.
            04   XMITMAIL-MSG      PIC X(80) OCCURS 360.

./ ADD NAME=XMITMACF 0130-00332-10217-2317-00098-00046-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      *          CONTROL BLOCK DETAILS                                 *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 NOV 2000 1.1  CREATED FROM XMITMAC                     AWR  *
      * 06 DEC 2000 1.2  PROCESS-ENV FLAG ADDED                   AWR  *
      * 02 AUG 2010 1.6  NJE-NODE ADDED FOR SECURE CALL           AWR  *
      *                                                                *
      ******************************************************************

            04   XMITMAIL-CONTROL-FIELDS.

                07   XMITMAIL-VER.

                    10   XMITMAIL-VERSION         PIC X(8)
                                                  VALUE '01.06'.

                07   XMITMAIL-FLAGS.

                    10   XMITMAIL-REPLY           PIC X VALUE ' '.
                    10   XMITMAIL-PROCESS-OPTION  PIC X VALUE '1'.
                    10   XMITMAIL-DEBUG           PIC X VALUE 'N'.
                    10   XMITMAIL-PLATFORM        PIC X VALUE 'M'.
                    10   XMITMAIL-ENV             PIC X VALUE ' '.
                    10   XMITMAIL-FLAG-RESERVE6   PIC X VALUE ' '.
                    10   XMITMAIL-FLAG-RESERVE7   PIC X VALUE ' '.
                    10   XMITMAIL-FLAG-RESERVE8   PIC X VALUE ' '.

                07   XMITMAIL-NUMBERS.

                    10   XMITMAIL-LINE-LENGTH     PIC S9(8)
                                                  COMP VALUE 80.
                    10   XMITMAIL-MAX-MAILS       PIC S9(8)
                                                  COMP VALUE 999.
                    10   XMITMAIL-NUMBER-RESERVE3 PIC S9(8)
                                                  COMP VALUE 0.
                    10   XMITMAIL-NUMBER-RESERVE4 PIC S9(8)
                                                  COMP VALUE 0.
                    10   XMITMAIL-NUMBER-RESERVE5 PIC S9(8)
                                                  COMP VALUE 0.
                    10   XMITMAIL-NUMBER-RESERVE6 PIC S9(8)
                                                  COMP VALUE 0.
                    10   XMITMAIL-NUMBER-RESERVE7 PIC S9(8)
                                                  COMP VALUE 0.
                    10   XMITMAIL-NUMBER-RESERVE8 PIC S9(8)
                                                  COMP VALUE 0.


                07   XMITMAIL-FROM          PIC X(80) VALUE HIGH-VALUES.

                07   XMITMAIL-RECEIPT       PIC X(80) VALUE HIGH-VALUES.

                07   XMITMAIL-REPLYTO       PIC X(80) VALUE HIGH-VALUES.

                07   XMITMAIL-DIAGNOSTIC    PIC X(80) VALUE ' '.

                07   XMITMAIL-NJE-NODE      PIC X(8) VALUE ' '.

            04   FILLER                 PIC X(192) VALUE LOW-VALUES.
./ ADD NAME=XMITMACM 0127-00328-09341-1633-00311-00133-00000-TSO057


      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************











      ******************************************************************
      *                                                                *
      * This is a COBOL program to allow batch programs to issue TSO/E *
      * commands EVEN THOUGH THEY ARE NOT RUNNING UNDER THE TMP.       *
      *                                                                *
      * It does this by using the TSO environment service facility     *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                  AWR  *
      * 04 Mar 2005 1.5  use BPXWDYN                              AWR  *
      *                                                                *
      ******************************************************************



       IDENTIFICATION DIVISION.
       PROGRAM-ID.  'XMITMACM'.

       ENVIRONMENT DIVISION.
       DATA DIVISION.
       FILE SECTION.
       WORKING-STORAGE SECTION.


         01 W-N1                 PIC -----9.

         01 BPXWDYN-NAME         PIC X(8) VALUE 'BPXWDYN'.

         01 BPXWDYN-COMMAND.
           04 BPXWDYN-COMMAND-LEN PIC S9(4) COMP VALUE 355.
           04 BPXWDYN-COMMAND-TXT PIC X(255).
           04 BPXWDYN-COMMAND-T2  PIC X(100) VALUE ' SHORTRC'.

       LINKAGE SECTION.


         COPY XMITMAC.

         01 XMITMACM-COMMAND     PIC X(255).

         01 XMITMACM-COMMAND-RC  PIC S9(8) COMP.

       PROCEDURE DIVISION USING
           XMITMAIL-CONTROL
           XMITMACM-COMMAND
           XMITMACM-COMMAND-RC.

           MOVE XMITMACM-COMMAND TO BPXWDYN-COMMAND-TXT

           CALL BPXWDYN-NAME USING BPXWDYN-COMMAND

           IF RETURN-CODE > 4  OR RETURN-CODE < 0
               MOVE 'N' TO XMITMAIL-REPLY
               MOVE 0 TO XMITMACM-COMMAND-RC
               MOVE RETURN-CODE TO W-N1
               STRING
               'BPXWDYN FAILED RC='
               W-N1
               DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
           ELSE
               MOVE 'V' TO XMITMAIL-REPLY
           END-IF

           MOVE 0 TO RETURN-CODE

           GOBACK.



       END PROGRAM 'XMITMACM'.


      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************
      *
      *
      *
      *
      *
      *
      *
      *
      *
      *
      *
      ******************************************************************
      *                                                                *
      * This is a COBOL program to allow batch programs to issue TSO/E *
      * commands EVEN THOUGH THEY ARE NOT RUNNING UNDER THE TMP.       *
      *                                                                *
      * It does this by using the TSO environment service facility     *
      *                                                                *
      ******************************************************************
      *
      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                  AWR  *
      *                                                                *
      ******************************************************************
      *
      *
      *
      *
      *IDENTIFICATION DIVISION.
      *PROGRAM-ID. XMITMACM
      *
      *
      *
      *
      *ENVIRONMENT DIVISION.
      *DATA DIVISION.
      *FILE SECTION.
      *WORKING-STORAGE SECTION.
      *
      *  01 TSOEV-PARM1          PIC S9(8) VALUE +0   COMP.
      *  01 TSOEV-RETURN-CODE    PIC S9(8) VALUE +0   COMP.
      *  01 TSOEV-REASON-CODE    PIC S9(8) VALUE +0   COMP.
      *  01 TSOEV-ABEND-CODE     PIC S9(8) VALUE +0   COMP.
      *  01 TSOEV-CPPL-ADDR      PIC S9(8) VALUE +0   COMP.
      *
      *  01 TSF-FLAGS            PIC S9(8)            COMP.
      *  01 TSF-COMMAND          PIC X(255).
      *  01 TSF-COMMAND-LEN      PIC S9(8) VALUE +255 COMP.
      *  01 TSF-COMMAND-RC       PIC S9(8) VALUE +0   COMP.
      *  01 TSF-REASON-CODE      PIC S9(8) VALUE +0   COMP.
      *  01 TSF-COMMAND-ABEND-CODE PIC S9(8) VALUE +0 COMP.
      *
      *  01 CALL-UNAUTH          PIC S9(8) VALUE +65536 COMP.
      *  01 REQUEST-DUMP         PIC S9(8) VALUE +256 COMP.
      *  01 INVOKE-REXX          PIC S9(8) VALUE +1   COMP.
      *
      *  01 FIRST-TIME           PIC X VALUE 'Y'.
      *
      *  01 W-N1                 PIC 9(8).
      *  01 W-N2                 PIC 9(8).
      *  01 W-N3                 PIC 9(8).
      *  01 N-IKJTSOEV           PIC X(8) VALUE 'IKJTSOEV'.
      *  01 N-TSOLNK             PIC X(8) VALUE 'TSOLNK  '.
      *
      *LINKAGE SECTION.
      *
      *
      *  COPY XMITMAC.
      *
      *  01 XMITMACM-COMMAND     PIC X(255).
      *
      *  01 XMITMACM-COMMAND-RC  PIC S9(8) COMP.
      *
      *PROCEDURE DIVISION USING
      *    XMITMAIL-CONTROL
      *    XMITMACM-COMMAND
      *    XMITMACM-COMMAND-RC.
      *
      *    IF FIRST-TIME = 'Y'
      *
      *        CALL N-IKJTSOEV USING TSOEV-PARM1
      *                              TSOEV-RETURN-CODE
      *                              TSOEV-REASON-CODE
      *                              TSOEV-ABEND-CODE
      *                              TSOEV-CPPL-ADDR
      *
      *        IF RETURN-CODE > 0
      *        AND NOT(
      *        RETURN-CODE = 8
      *        OR RETURN-CODE = 16
      *        OR RETURN-CODE = 24
      *        )
      *            MOVE RETURN-CODE TO W-N1
      *            MOVE TSOEV-REASON-CODE TO W-N2
      *            MOVE TSOEV-ABEND-CODE TO W-N3
      *            MOVE 'N' TO XMITMAIL-REPLY
      *            MOVE 0 TO RETURN-CODE
      *            STRING
      *            'IKJTSOEV FAILED RC='
      *            W-N1
      *            ' RSNCD='
      *            W-N2
      *            ' ABNDCD='
      *            W-N2
      *            DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
      *            GOBACK
      *        END-IF
      *        MOVE 'N' TO FIRST-TIME
      *    END-IF
      *
      *    MOVE 0 TO TSF-FLAGS
      *    ADD CALL-UNAUTH TO TSF-FLAGS
      *    ADD INVOKE-REXX TO TSF-FLAGS
      *
      *    MOVE XMITMACM-COMMAND TO TSF-COMMAND
      *
      *    MOVE 0 TO TSF-COMMAND-RC
      *    MOVE 0 TO TSF-REASON-CODE
      *    MOVE 0 TO TSF-COMMAND-ABEND-CODE
      *
      *    CALL N-TSOLNK USING TSF-FLAGS
      *                        TSF-COMMAND
      *                        TSF-COMMAND-LEN
      *                        TSF-COMMAND-RC
      *                        TSF-REASON-CODE
      *                        TSF-COMMAND-ABEND-CODE
      *
   ****
   ****    display ' '
   ****    display 'tsolnk called'
   ****    display '             '
   ****    display 'FLAGS              ' TSF-FLAGS
   ****    display 'COMMAND            ' TSF-COMMAND
   ****    display 'COMMAND-LEN        ' TSF-COMMAND-LEN
   ****    display 'COMMAND-RC         ' TSF-COMMAND-RC
   ****    display 'REASON-CODE        ' TSF-REASON-CODE
   ****    display 'COMMAND-ABEND-CODE ' TSF-COMMAND-ABEND-CODE
   ****
      *
      *    IF RETURN-CODE > 4
      *        MOVE 'N' TO XMITMAIL-REPLY
      *        MOVE 0 TO XMITMACM-COMMAND-RC
      *        MOVE RETURN-CODE TO W-N1
      *        MOVE TSF-COMMAND-RC    TO W-N2
      *        MOVE TSF-REASON-CODE   TO W-N3
      *        STRING
      *        'TSOLNK FAILED RC='
      *        W-N1
      *        ' COMMAND-RC='
      *        W-N2
      *        ' REASON-CODE='
      *        W-N3
      *        DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
      *    ELSE
      *        MOVE 'V' TO XMITMAIL-REPLY
      *        MOVE TSF-COMMAND-RC TO XMITMACM-COMMAND-RC
      *        IF XMITMACM-COMMAND-RC > 4
      *            MOVE 'N' TO XMITMAIL-REPLY
      *            MOVE TSF-COMMAND-RC TO W-N1
      *            STRING
      *            'COMMAND FAILED RC='
      *            W-N1
      *            ' : '
      *            XMITMACM-COMMAND
      *            DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
      *        END-IF
      *    END-IF
      *
      *    MOVE 0 TO RETURN-CODE
      *
      *    GOBACK.
      *
      *
      *END PROGRAM XMITMACM.
./ ADD NAME=XMITMADF 0137-00328-10210-1522-00179-00027-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * DEFAULT VALUES FOR XMITMAIL AND XMITCICS                       *
      *                                                                *
      * THIS MEMBER SHOULD BE CUSTOMISED BEFORE YOU COMPILE XMITMAIL   *
      * AND XMITCICS BY RUNNING THE XMITINST JOB                       *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 26 Nov 2000 1.1  Updates for XMITCICS                     AWR  *
      * 21 JUL 2010 1.6  SECURE FLAG ADDED                        AWR  *
      *                                                                *
      ******************************************************************



       01 XMITMAIL-DEFAULTS.



                07   XMITMAIL-CUSTOMISE.



      *
      *             * -------------------------- *
      *             * nje address of smtp server *
      *             * -------------------------- */

                    10   XMITMAIL-SMTP-ADDRESS  PIC X(80) VALUE 'SMTP'.




      *             * -------------------------- */
      *             * Define the Center which    */
      *             * is the nje node name where */
      *             * the smtp server is running.*
      *             * -------------------------- *

                    10   XMITMAIL-CENTER        PIC X(80) VALUE 'MC1'.




      *
      *             * --------------------------------------------------
      *             * Setup the From Default
      *             * If you don't want a "FROM" generated by default
      *             * leave this blank
      *             * --------------------------------------------------

                    10   XMITMAIL-FROM-DEFAULT  PIC X(80) VALUE
                       'postmaster@johnlewis.co.uk'.





      *
      *             * --------------------------------------------------
      *             * The EXIT module.
      *             *
      *             * If this field is non-blank, the module named is
      *             * dynamically called at the start of XMITMAIL,
      *             * before any other processing has been done
      *             *
      *             * You may use this module (which must be present as
      *             * loadable module in the LINKLIST/STEPLIB or DFHRPL)
      *             * to dynamically change XMITMAIL parameters or to
      *             * reject them
      *             *
      *             * To reject an e-mail, place "X" in XMITMAIL-REPLY
      *             * and put a diagnostic in XMITMAIL-DIAGNOSTIC
      *             *
      *             * See sample member XMITEXIT on this library
      *             *
      *             *
      *             * The COBOL statement used to call this module is:
      *             *
      *             *
      *             * CALL XMITMAIL-EXIT-MOD USING
      *             *         XMITMAIL-CONTROL
      *             *         XMITMAIL-DEFAULTS
      *             *         XMITMAIL-TO
      *             *         XMITMAIL-CC
      *             *         XMITMAIL-BCC
      *             *         XMITMAIL-SUBJECT
      *             *         XMITMAIL-MSG
      *             *
      *             * --------------------------------------------------

                    10   XMITMAIL-EXIT-MOD   PIC X(8) VALUE '        '.





      *
      *             * --------------------------------------------------
      *             *
      *             * Normally the EXIT module is called only once
      *             * just before the first e-mail.  If you want the
      *             * EXIT module to be called for EVERY e-mail,
      *             * you must reset this flag to "Y" (from within
      *             * the EXIT - see XMITEXIT sample) EVERY time the
      *             * EXIT module is called. If you do not reset this
      *             * flag to "Y", XMITMAIL will stop calling the
      *             * exit module
      *             *
      *             * --------------------------------------------------

                    10   XMITMAIL-CALL-EXIT PIC X VALUE 'Y'.





      *
      *             * --------------------------------------------------
      *             *
      *             * This is a persistent workarea for the exit
      *             * module.  Only needed if your exit module is ASM
      *             *
      *             * --------------------------------------------------

                    10   XMITMAIL-EXIT-WORKAREA PIC X(80).



      *
      *             * --------------------------------------------------
      *             *
      *             * Set to Y to use SECURE (TSO TRANSMIT format)
      *             * spool files
      *             *
      *             * --------------------------------------------------

                    10   XMITMAIL-SECURE        PIC X VALUE 'N'.



./ ADD NAME=XMITMAFM 0164-00328-10203-1807-00564-00379-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * XMITMAFM takes the input parameters and produces a single      *
      * field with the output lines packed into it.                    *
      *                                                                *
      * Lines are all the same length, being = to the longest mail     *
      * or control record                                              *
      *                                                                *
      * The end of the last line is signalled by 8O bytes high-values  *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                  AWR  *
      * 22 Nov 2000 1.2  allow process-option 2                   AWR  *
      * 17 Jan 2005 1.4  add DATE: header                         AWR  *
      * 17 JUL 2010 1.6  TO FIXED LENGHTH FORM                    AWR  *
      *                                                                *
      ******************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITMAFM'.
      *
      *
      *
      *
       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.



       01   W-WORK.
            04   W-OFFSET                PIC S9(8) COMP.
            04   W-COUNT                 PIC S9(8) COMP.
            04   XMITMAFM-CHARNO         PIC S9(8) COMP.
            04   LAST-NONBLANK-XMITMAFM-CHARNO
                                         PIC S9(8) COMP.
            04   LINE-CHARNO             PIC S9(8) COMP.
            04   ID-COUNT                PIC S9(8) COMP.
            04   W-BUFFER                PIC S9(8) COMP.
            04   W                       PIC X(80).
            04   W1                      PIC X(80).
            04   W2                      PIC X(80).
            04   W3                      PIC X(80).

       01   W-LINE                       PIC X(255).
       01   W-LINE2                      PIC X(256).

       01   W-FROM                       PIC X(80).
       01   W-RECEIPT                    PIC X(80).
       01   W-REPLYTO                    PIC X(80).

       01   W-MONTHS
             PIC X(36) VALUE
           'JanFebMarAprMayJunJulAugSepOctNovDec'.
       01   FILLER REDEFINES W-MONTHS.
           04   W-MONTH PIC XXX OCCURS 12.

       01   W-MONTH-X-X.
           04   W-MONTH-X                PIC 99.

       LINKAGE SECTION.

       COPY XMITMAC.

       COPY XMITMADF.

       01   XMITMAIL-TOS.
            04   XMITMAIL-TO       PIC X(80) OCCURS 100.

       01   XMITMAIL-CCS.
            04   XMITMAIL-CC       PIC X(80) OCCURS 100.

       01   XMITMAIL-BCCS.
            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.

       01   XMITMAIL-SUBJECT       PIC X(80).

       01   XMITMAIL-MSGS.
            04   XMITMAIL-MSG      PIC X(80)
                   copy xmitsize.

       01   XMITMAFM-BACK.
            04   FILLER            PIC X(800).
            04   XMITMAIL-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.

       01   XMITMAFM-RECL           PIC S9(8) COMP.
       01   XMITMAFM-TOT-RECNO      PIC S9(8) COMP.


       PROCEDURE DIVISION USING
            XMITMAIL-CONTROL
            XMITMAIL-DEFAULTS
            XMITMAIL-TOS
            XMITMAIL-CCS
            XMITMAIL-BCCS
            XMITMAIL-SUBJECT
            XMITMAIL-MSGS
            XMITMAFM-BACK
            XMITMAFM-RECL
            XMITMAFM-TOT-RECNO
            .

           MOVE 'E' TO XMITMAIL-REPLY
           MOVE 1 TO XMITMAFM-CHARNO
           MOVE 0 TO XMITMAFM-TOT-RECNO



           COMPUTE W-BUFFER = LENGTH OF XMITMAFM-BACK -
                             ((LENGTH OF W-LINE)*2)

           EVALUATE TRUE

           WHEN XMITMAIL-PROCESS-OPTION = '1'

      *        Plain text

               PERFORM CHECK-LINE-LENGTH
               PERFORM DETERMINE-ADDRESSEES
               PERFORM CREATE-HEADER
               PERFORM ADD-BLANK
               PERFORM MOVE-IN-MESSAGE-IPD
               PERFORM END-ENVELOPE

           WHEN XMITMAIL-PROCESS-OPTION = '2'

      *        User formatted

               PERFORM CHECK-LINE-LENGTH
               PERFORM DETERMINE-ADDRESSEES
               PERFORM CREATE-HEADER
               PERFORM MOVE-IN-MESSAGE-IPD
               PERFORM END-ENVELOPE

           WHEN OTHER

               MOVE 'P' TO XMITMAIL-REPLY
               MOVE 'INVALID PROCESS-OPTION' TO XMITMAIL-DIAGNOSTIC
               GOBACK

           END-EVALUATE

           MOVE 'V' TO XMITMAIL-REPLY
           GOBACK.



           .
       CHECK-LINE-LENGTH.

           IF XMITMAIL-LINE-LENGTH > LENGTH OF W-LINE
           OR XMITMAIL-LINE-LENGTH < 10
               MOVE 'L' TO XMITMAIL-REPLY
               GOBACK
           END-IF

           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL
           IF 80 > XMITMAFM-RECL
               MOVE 80 TO XMITMAFM-RECL
           END-IF
           ADD 1 TO XMITMAFM-RECL
      *    FOR POSS INITIAL PERIOD

           .
       DETERMINE-ADDRESSEES.

      *    DECIDE VALUES OF FROM, RECEIPT, REPLYTO

           MOVE XMITMAIL-FROM TO W-FROM
           IF W-FROM = HIGH-VALUES OR SPACES
               MOVE XMITMAIL-FROM-DEFAULT TO W-FROM
           END-IF

           MOVE XMITMAIL-REPLYTO TO W-REPLYTO

           MOVE XMITMAIL-RECEIPT TO W-RECEIPT

           .
       CREATE-HEADER.

      *    CREATE HEADER

           MOVE ' ' TO W-LINE
           STRING
               'helo '
                   DELIMITED SIZE
               XMITMAIL-CENTER
                   DELIMITED SIZE
           INTO W-LINE
           PERFORM ADD-LINE

           IF NOT (W-FROM  = HIGH-VALUES OR SPACES)

               MOVE ' ' TO W-LINE
               STRING
                   'mail from:<'
                       DELIMITED SIZE
                   W-FROM
                       DELIMITED SPACE
                   '>'
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE

           END-IF

           IF XMITMAIL-TO(1) = HIGH-VALUES OR SPACES
               MOVE 'NO "TO" PROVIDED' TO XMITMAIL-DIAGNOSTIC
               MOVE 'A' TO XMITMAIL-REPLY
               GOBACK
           END-IF


           PERFORM VARYING ID-COUNT FROM 1 BY 1
           UNTIL XMITMAIL-TO(ID-COUNT) = HIGH-VALUES OR SPACES

               MOVE XMITMAIL-TO(ID-COUNT) TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'rcpt to:<'
                       DELIMITED SIZE
                   XMITMAIL-TO(ID-COUNT)
                       DELIMITED SPACE
                   '>'
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE

           END-PERFORM


           PERFORM VARYING ID-COUNT FROM 1 BY 1
           UNTIL XMITMAIL-CC(ID-COUNT) = HIGH-VALUES OR SPACES

               MOVE XMITMAIL-CC(ID-COUNT) TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'rcpt to:<'
                       DELIMITED SIZE
                   XMITMAIL-CC(ID-COUNT)
                       DELIMITED SPACE
                   '>'
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE

           END-PERFORM


           PERFORM VARYING ID-COUNT FROM 1 BY 1
           UNTIL XMITMAIL-BCC(ID-COUNT) = HIGH-VALUES OR SPACES

               MOVE XMITMAIL-BCC(ID-COUNT) TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'rcpt to:<'
                       DELIMITED SIZE
                   XMITMAIL-BCC(ID-COUNT)
                       DELIMITED SPACE
                   '>'
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE

           END-PERFORM


           MOVE 'data ' TO W-LINE
           PERFORM ADD-LINE


           MOVE ' ' TO W-LINE
           STRING
               'Sender:  '
                   DELIMITED SIZE
               W-FROM
                   DELIMITED SIZE
           INTO W-LINE
           PERFORM ADD-LINE

           MOVE FUNCTION CURRENT-DATE(5:2) TO W-MONTH-X-X

           MOVE ' ' TO W-LINE
           STRING
               'Date:    '

               FUNCTION CURRENT-DATE(7:2)
               ' '
               W-MONTH (W-MONTH-X)
               ' '
               FUNCTION CURRENT-DATE(1:4)
               ' '
               FUNCTION CURRENT-DATE(9:2)
               ':'
               FUNCTION CURRENT-DATE(11:2)
               ':'
               FUNCTION CURRENT-DATE(13:2)
               ' '
               FUNCTION CURRENT-DATE(17:5)

                   DELIMITED SIZE

           INTO W-LINE
           PERFORM ADD-LINE


           IF NOT (W-FROM = HIGH-VALUES OR SPACES)

               MOVE W-FROM TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'From:    '
                       DELIMITED SIZE
                   W-FROM
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE
           END-IF


           IF NOT (W-REPLYTO = HIGH-VALUES OR SPACES)

               MOVE W-REPLYTO TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'Reply-To: '
                       DELIMITED SIZE
                   W-REPLYTO
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE
           END-IF


           IF NOT (W-RECEIPT = HIGH-VALUES OR SPACES)

               MOVE W-RECEIPT TO W
               PERFORM CHECK-ID

               MOVE ' ' TO W-LINE
               STRING
                   'Return-Receipt-To: '
                       DELIMITED SIZE
                   W-RECEIPT
                       DELIMITED SIZE
               INTO W-LINE
               PERFORM ADD-LINE
           END-IF


           PERFORM VARYING ID-COUNT FROM 1 BY 1
           UNTIL XMITMAIL-TO(ID-COUNT) = HIGH-VALUES OR SPACES

               MOVE ' ' TO W-LINE
               STRING
                   'To:       '
                       DELIMITED SIZE
                   XMITMAIL-TO(ID-COUNT)
                       DELIMITED SPACE
               INTO W-LINE
               IF ID-COUNT > 1 MOVE ' ' TO W-LINE(1:6) END-IF
               PERFORM ADD-LINE

           END-PERFORM


           PERFORM VARYING ID-COUNT FROM 1 BY 1
           UNTIL XMITMAIL-CC(ID-COUNT) = HIGH-VALUES OR SPACES

               MOVE ' ' TO W-LINE
               STRING
                   'Cc:       '
                       DELIMITED SIZE
                   XMITMAIL-CC(ID-COUNT)
                       DELIMITED SPACE
               INTO W-LINE
               IF ID-COUNT > 1 MOVE ' ' TO W-LINE(1:6) END-IF
               PERFORM ADD-LINE

           END-PERFORM



           MOVE ' ' TO W-LINE
           STRING
               'X-Mailer: XMITMAIL COBOL subroutine on MVS'
                   DELIMITED SIZE
           INTO W-LINE
           PERFORM ADD-LINE

           MOVE ' ' TO W-LINE
           STRING
               'Subject: '
                   DELIMITED SIZE
               XMITMAIL-SUBJECT
                   DELIMITED SIZE
           INTO W-LINE
           PERFORM ADD-LINE


           .
       ADD-BLANK.

               MOVE ' ' TO W-LINE
               PERFORM ADD-LINE


           .
       MOVE-IN-MESSAGE-IPD.



      *    MOVE IN MESSAGE DOUBLING INITIAL PERIODS

           MOVE 1 TO W-COUNT
           PERFORM COMPUTE-W-OFFSET

           PERFORM UNTIL
           XMITMAIL-MSGS(W-OFFSET:XMITMAIL-LINE-LENGTH)
           = HIGH-VALUE
               MOVE XMITMAIL-MSGS(W-OFFSET:XMITMAIL-LINE-LENGTH)
               TO W-LINE

               IF W-LINE(1:1) = '.'
                   MOVE W-LINE  TO W-LINE2
                   MOVE W-LINE2 TO W-LINE(2:)
               END-IF

               PERFORM ADD-LINE
               ADD 1 TO W-COUNT
               PERFORM COMPUTE-W-OFFSET
           END-PERFORM



           .
       END-ENVELOPE.


      *    END

           MOVE ' ' TO W-LINE
           PERFORM ADD-LINE

           MOVE '.' TO W-LINE
           PERFORM ADD-LINE

           MOVE 'QUIT ' TO W-LINE
           PERFORM ADD-LINE


           MOVE HIGH-VALUES TO XMITMAFM-BACK(XMITMAFM-CHARNO:255)






           .
       BUFFER-CHECK.
           IF XMITMAFM-CHARNO > W-BUFFER
           MOVE 'BUFFER OVERFLOW' TO XMITMAIL-DIAGNOSTIC
           MOVE 'O' TO XMITMAIL-REPLY
           GOBACK.


           .
       ADD-LINE.


           MOVE W-LINE
           TO XMITMAFM-BACK(XMITMAFM-CHARNO:XMITMAFM-RECL)

           ADD XMITMAFM-RECL TO XMITMAFM-CHARNO

           ADD 1 TO XMITMAFM-TOT-RECNO

           PERFORM BUFFER-CHECK


           .
       CHECK-ID.

           MOVE ' ' TO W1 W2 W3
           UNSTRING W DELIMITED ' ' INTO W1 W2
           IF W1(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF
           IF W2(1:1) NOT = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF

           MOVE ' ' TO W1 W2 W3
           UNSTRING W DELIMITED '@' INTO W1 W2
           IF W1(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF
           IF W2(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF
           UNSTRING W2 DELIMITED '@' INTO W1 W3
           IF W3 NOT = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF

           IF XMITMAIL-REPLY = 'A'
               STRING 'INVALID ADDRESS ' W DELIMITED SIZE
               INTO XMITMAIL-DIAGNOSTIC
               GOBACK
           END-IF




           .
       COMPUTE-W-OFFSET.

           COMPUTE W-OFFSET = ((W-COUNT - 1) *
           XMITMAIL-LINE-LENGTH) + 1


           .
       END PROGRAM 'XMITMAFM'.

./ ADD NAME=XMITMAIL 0199-00328-10264-1547-00315-00244-00000-TSO057

      **************************************************************
      *   XMITMAIL batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * SUBROUTINE TO SEND A SIMPLE E-MAIL BY SPOOLING OUTPUT TO       *
      * SMTP.  RUNS IN BATCH OR UNDER TSO/ISPF.                        *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Nov 2000 1.0  written                                       *
      * 22 Feb 2005 1.5  Call to XMITMACM fixed thx Bruce Coghill      *
      *                                                                *
      *                                                                *
      ******************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITMAIL'.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT OUTFILE ASSIGN TO XMITMAIL ORGANISATION SEQUENTIAL
           FILE STATUS IS OUTFILE-STATUS.

       DATA DIVISION.
       FILE  SECTION.

       FD   OUTFILE
            RECORD VARYING 1 TO 256 DEPENDING OUTFILE-LENGTH
            RECORDING MODE V
            .

       01   OUTFILE-LINE PIC X(256).
*********   not 255 cos of poss initial double period


       WORKING-STORAGE SECTION.


       01   OUTFILE-STATUS         PIC XX.
       01   OUTFILE-LENGTH         PIC 9(8) COMP.


       01   XMITMACM-COMMAND       PIC X(255).
       01   XMITMACM-COMMAND-RC    PIC S9(8) COMP VALUE 0.



       01   XMITMAFM-BACK.
            04   FILLER            PIC X(800).
            04   XMITMAIL-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.

       01   XMITINMR-BACK.
            04   FILLER            PIC X(800).
            04   XMITINMR-MSGDUMY  PIC X(80)
                   COPY XMITSIZE.

       01   XMITMAFM-RECL         PIC S9(8) COMP.
       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.
       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.

       01   W-WORK.
            04   XMITINMR-CHARNO   PIC S9(8) COMP.
            04   XMITMAFM-CHARNO   PIC S9(8) COMP.
            04   OUTFILE-CHARNO    PIC S9(8) COMP.
            04   MAIL-COUNT        PIC S9(8) COMP VALUE 0.
            04   W-LINE            PIC X(255).

       01  USER-ID                        PIC X(8).
       01  NJE-NODE                       PIC X(8).



       COPY XMITMADF.


       LINKAGE SECTION.

       COPY XMITMAC.

       01   XMITMAIL-TOS.
            04   XMITMAIL-TO       PIC X(80) OCCURS 100.

       01   XMITMAIL-CCS.
            04   XMITMAIL-CC       PIC X(80) OCCURS 100.

       01   XMITMAIL-BCCS.
            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.

       01   XMITMAIL-SUBJECT       PIC X(80).

       01   XMITMAIL-MSGS.
            04   XMITMAIL-MSG      PIC X(80)
                                 copy xmitsize.

       PROCEDURE DIVISION USING
            XMITMAIL-CONTROL
            XMITMAIL-TOS
            XMITMAIL-CCS
            XMITMAIL-BCCS
            XMITMAIL-SUBJECT
            XMITMAIL-MSGS
            .

           MOVE 'B' TO XMITMAIL-ENV



           MOVE 'E' TO XMITMAIL-REPLY
           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC

           IF XMITMAIL-MAX-MAILS NOT = 0
               IF MAIL-COUNT > XMITMAIL-MAX-MAILS
                   MOVE 'M' TO XMITMAIL-REPLY
                   MOVE 'XMITMAIL-MAX-MAILS EXCEEDED '
                   TO XMITMAIL-DIAGNOSTIC
                   GOBACK
               END-IF
           END-IF


           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL
           IF 80 > XMITMAFM-RECL
               MOVE 80 TO XMITMAFM-RECL
           END-IF
           ADD 1 TO XMITMAFM-RECL
      *    FOR POSS INITIAL PERIOD

           IF XMITMAIL-SECURE= 'Y'
               CALL 'XMITNODE' USING NJE-NODE
               CALL 'XMITUID'  USING USER-ID
           END-IF

           PERFORM CALL-EXIT

           PERFORM FORMAT-MESSAGE
           PERFORM ALLOC-OUTFILE
           PERFORM OPEN-OUTFILE
           PERFORM WRITE-MESSAGE
           PERFORM CLOSE-OUTFILE
           PERFORM FREE-OUTFILE

           ADD 1 TO MAIL-COUNT




           MOVE 'V' TO XMITMAIL-REPLY
           MOVE ' ' TO XMITMAIL-DIAGNOSTIC
           MOVE 0 TO RETURN-CODE
           GOBACK

           .



           .
       OPEN-OUTFILE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY ' '
               DISPLAY '....  SPOOL FILE STARTS  .... '
           ELSE
               OPEN OUTPUT OUTFILE
               IF OUTFILE-STATUS NOT = '00'
                   STRING 'XMITMAIL: OPEN FOR DD "XMITMAIL" '
                   'FAILED FILE STATUS = ' OUTFILE-STATUS
                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
                   MOVE 'I' TO XMITMAIL-REPLY
                   MOVE 0 TO RETURN-CODE
                   GOBACK
               END-IF
           END-IF






           .
       WRITE-LINE-SECURE.
           PERFORM WRITE-LINE



           .
       WRITE-LINE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY W-LINE
           ELSE
               MOVE W-LINE TO OUTFILE-LINE
               WRITE OUTFILE-LINE
               IF OUTFILE-STATUS NOT = '00'
                   STRING 'XMITMAIL: WRITE FOR DD "XMITMAIL" '
                   'FAILED FILE STATUS = ' OUTFILE-STATUS
                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC
                   MOVE 'I' TO XMITMAIL-REPLY
                   MOVE 0 TO RETURN-CODE
                   GOBACK
               END-IF
           END-IF



           .
       CLOSE-OUTFILE.
           IF XMITMAIL-DEBUG = 'Y'
               DISPLAY '....  SPOOL FILE ENDS  .... '
               DISPLAY ' '
           ELSE
               CLOSE OUTFILE
           END-IF



           .
       ALLOC-OUTFILE.
           IF XMITMAIL-DEBUG NOT = 'Y'
               MOVE ' '
               TO XMITMACM-COMMAND

               STRING
                    'ALLOC FI(XMITMAIL) SYSOUT(A) DEST('
                      DELIMITED SIZE
                      XMITMAIL-SMTP-ADDRESS
                      DELIMITED SPACE
                      ')'
                      DELIMITED SIZE
               INTO XMITMACM-COMMAND
********       STRING
********            "ALLOC FI(XMITMAIL) DSN('INST.TSO057.NOTE') "
********            DELIMITED SIZE
********            'SHR                      '
********            DELIMITED SIZE
********       INTO XMITMACM-COMMAND
********       IF XMITMAIL-SECURE = 'Y'
********       STRING
********            "ALLOC FI(XMITMAIL) DSN('INST.TSO057.SECURE') "
********            DELIMITED SIZE
********            'SHR                      '
********            DELIMITED SIZE
********       INTO XMITMACM-COMMAND
********       END-IF
               CALL 'XMITMACM' USING
                   XMITMAIL-CONTROL
                   XMITMACM-COMMAND
                   XMITMACM-COMMAND-RC
               IF XMITMAIL-REPLY NOT = 'V'
                   MOVE 0 TO RETURN-CODE
                   GOBACK
               END-IF
           END-IF



           .
       FREE-OUTFILE.
           IF XMITMAIL-DEBUG NOT = 'Y'
               MOVE 'FREE FI(XMITMAIL) '
               TO XMITMACM-COMMAND

               CALL 'XMITMACM' USING
                   XMITMAIL-CONTROL
                   XMITMACM-COMMAND
                   XMITMACM-COMMAND-RC
           END-IF

           .


       COPY XMITCOMM.

       COPY XMITMACM.

       COPY XMITMAFM.

       COPY XMITINMR.

       END PROGRAM 'XMITMAIL'.

./ ADD NAME=XMITMIME 0104-05062-05062-1706-00186-00161-00000-TSO057

      **************************************************************
      *   XMITSMS batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
               XMITMIME .

      ******************************************************************
      *                                                                *
      * XMITMIME.  Create mime attachment                              *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 06 Mar 2005 1.5  New                                      AWR  *
      *                                                                *
      ******************************************************************

       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01   XMITMAIL-MSG-OFFSET PIC S9(8).
       01   MIMELINE-LENGTH    PIC S9(8).
       01   MIMELINE-OFFSET    PIC S9(8).
       01   MIMELINES-X.
           04   MIMELINES          PIC X(300000).
           04   MIME-BUFFER        PIC X(300).

       01   W-1                PIC S9(8).

       LINKAGE         SECTION.


          COPY XMITMAC.

       01   XMITMAIL-MSG       PIC X(320000).

       01   ATTACHMENT-NAME        PIC X(80).

       01   XMITMAIL-BND          PIC X(37).

       01   BINARY-OBJECT         PIC X.
       01   BINARY-OBJECT-LENGTH  PIC S9(8) COMP.
       01   LINES-ADDED           PIC S9(8) COMP.


       PROCEDURE DIVISION using
            XMITMAIL-CONTROL
            XMITMAIL-MSG
            ATTACHMENT-NAME
            XMITMAIL-BND
            BINARY-OBJECT
            BINARY-OBJECT-LENGTH
            LINES-ADDED
              .


           MOVE 'E' TO XMITMAIL-REPLY

           MOVE 76 TO MIMELINE-LENGTH

           IF MIMELINE-LENGTH NOT < XMITMAIL-LINE-LENGTH
               COMPUTE
               MIMELINE-LENGTH = XMITMAIL-LINE-LENGTH
           END-IF

           MOVE 1 TO XMITMAIL-MSG-OFFSET

           COMPUTE W-1 = (3 * (LENGTH OF MIMELINES)/4)

           IF BINARY-OBJECT-LENGTH NOT < W-1
               MOVE 'O' TO XMITMAIL-REPLY
               MOVE 'BINARY OBJECT TOO BIG' TO XMITMAIL-DIAGNOSTIC
               GOBACK
           END-IF

           IF BINARY-OBJECT-LENGTH < 1
               MOVE 'O' TO XMITMAIL-REPLY
               MOVE 'BINARY OBJECT < 1 byte' TO XMITMAIL-DIAGNOSTIC
               GOBACK
           END-IF

           MOVE ' ' TO MIMELINES-X

           CALL 'XMIT64'  USING BINARY-OBJECT
                                BINARY-OBJECT-LENGTH
                                MIMELINES

           MOVE 1 TO XMITMAIL-MSG-OFFSET


           MOVE 'Content-Type: application/octet-stream;     '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE ' '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           STRING
                '              name="'   delimited size
                attachment-name           delimited space
                '"'   delimited size
           INTO
              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE 'Content-Transfer-Encoding: base64           '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE 'Content-Disposition: attachment;            '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE ' '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           STRING
                '          filename="'   delimited size
                attachment-name           delimited space
                '"'   delimited size
           INTO
              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE ' '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           STRING
                'Content-Description: "'  delimited size
                attachment-name           delimited space
                '"'   delimited size
           INTO
              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           MOVE ' '
           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET

           PERFORM VARYING MIMEline-OFFSET from 1 by MIMELINE-LENGTH
           UNTIL MIMELINES(MIMELINE-OFFSET:MIMELINE-LENGTH) =  ' '
             MOVE  MIMELINEs(MIMELINE-OFFSET:MIMELINE-LENGTH)
             TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
             ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET
           END-PERFORM

           MOVE ' ' to
           XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           STRING  '--' XMITMAIL-BND DELIMITED SIZE INTO
           XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)
           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET


           COMPUTE LINES-ADDED = XMITMAIL-MSG-OFFSET /
                                 XMITMAIL-LINE-LENGTH

           MOVE 'V' TO XMITMAIL-REPLY


           GOBACK  .

       copy xmit64 .
       end program xmitmime.

./ ADD NAME=XMITNODE 0115-10207-10208-1727-00204-00005-00204-TSO057
XMITNODE CSECT
XMITNODE AMODE 31
XMITNODE RMODE ANY

R0     EQU   0
R1     EQU   1
R2     EQU   2
R3     EQU   3
R4     EQU   4
R5     EQU   5
R6     EQU   6
R7     EQU   7
R8     EQU   8
R9     EQU   9
R10    EQU   10
R11    EQU   11
R12    EQU   12
R13    EQU   13
R14    EQU   14
R15    EQU   15

       USING *,R15
       SAVE (14,12),,'XMITNODE VER 1.6 &SYSDATE &SYSTIME '
       DROP  R15
       USING XMITNODE,R12      SET UP CSECT ADDRESSABILITY
       LR    R12,R15             LOAD BASE REGISTER

       L     R0,INSTWORK_DATALEN_A
       GETMAIN RU,LV=(0),LOC=BELOW   STORAGE FOR DATA DSECT, ADDR IN R1
       USING INSTWORK_DATA,R1
       ST    R13,INSTWORK_SAVEBK CHAIN BACK
       ST    R1,INSTWORK_SAVEFW-INSTWORK_SAVE(R13) CHAIN FOREWARD
       LR    R15,R1
       LM    R0,R1,INSTWORK_SAVER0-INSTWORK_SAVE(R13) RESTORE R0 R1
       LR    R13,R15             LOAD REGISTER 13 ADDR GETMAINED SA
       DROP  R1
       USING INSTWORK_DATA,R13   SET UP DATA DSECT ADDR.
       B     *+8
INSTWORK_DATALEN_A DC A(INSTWORK_DATALEN)




*
*  INFORMATION RETRIEVED FROM JES VIA IEFSSREQ
         L     R7,0(R1)

         XC    SSD1,SSD1
         XC    SSD2,SSD2
         MVC   ASSOB(SSVIDATA-ASSOB),AZZOB

         LA    R1,SSOB1
         ST    R1,ASSOB
         LA    R1,SSVI1
         ST    R1,SSOBPTR


         LA    R1,ASSOB
         IEFSSREQ ,
         LTR   R15,R15
         JNZ   RVCALL
*
         SR    R0,R0               NO REASON CODE
         L     R15,SSOB1+SSOBRETN-SSOB
         LTR   R15,R15
         BNZ   RVCALL
*
*  PARSE THE SSVI DATA RETURNED BY IEFSSREQ
*  STRATEGY IS TO USE THE POINTERS TO BUMP DOWN TO THE "SYSTEM DATA,"
*  THE SCAN A CHARACTER AT A TIME LOOKING FOR COMMAS, AND EACH TIME A
*  COMMA IS FOUND SEE IF THE FOLLOWING STRING IS "JES_NODE="
         LA    R3,SSVI1
         A     R3,SSVISDOF-SSVI(,R3)    OFFSET TO SYSTEM DATA
         LH    R2,0(,R3)           LENGTH OF SYSTEM DATA
*  QUESTION: DOES THIS LENGTH INCLUDE ITS OWN HALFWORD?
*  IT'S NOT REAL CRITICAL AS THIS IS LOCAL STORAGE AND NO S0C4 POSSIBLE
         LA    R3,2(,R3)           OKAY, SHOULD NOW POINT AT 1ST COMMA
*
* LOOP LOOKING FOR COMMA
NODE1LP  EQU   *
         CLI   0(R3),C','
         JNE   NODELP1X
*
*  FOUND A COMMA
         CLC   1(9,R3),=CL9'JES_NODE='
         JNE   NODELP1X
*
*  FOUND THE RIGHT TAG                      012345678901
         LA    R9,11(,R3)          GET PAST ,JES_NODE=
         J     NODEFND
*
*  KEEP GOING
NODELP1X EQU   *
         LA    R3,1(,R3)           NEXT CHARACTER
         BRCT  R2,NODE1LP
*
*  NOT FOUND
         LA    R9,=CL8'????????'   ???
         MVC  0(8,R7),0(R9)
         LA    R15,8
         B     X
NODEFND  DS    0H
         MVC  0(8,R7),0(R9)
         LA    R15,0
         B     X
RVCALL   LA    R9,=CL8'????????'   ???
         MVC  0(8,R7),0(R9)





X        DS    0H

         LR    R2,R15              SAVE R15
         LR    R1,R13              GET FREEMAIN ADDRESS
         L     R13,INSTWORK_SAVEBK R13 NOW OLD REG 13
         L     R0,=A(INSTWORK_DATALEN) SET GETMAIN LEN
         FREEMAIN RU,LV=(0),A=(1)   FREE DATA DSECT STORAGE
         LR    R15,R2              RC IN R15
         L     R14,12(R13)         RESTORE R14
         LM    R0,R12,20(R13)      RESTORE R0-R14
         BSM   0,R14

*
AZZOB    DC    A(ZZOB1)
*
ZZOB1    DC    0F'0'
         DC    CL4'SSOB'
         DC    Y(SSOBX-SSOB1)      LENGTH
         DC    Y(SSOBSSVI)         VERSION REQUEST = 54
         DC    A(0)                USE LIFE OF JOB SSIB
ZZOB1RET DC    F'0'
ZZOBPTR  DC    A(ZZVI1)
         DC    2F'0'
ZZOBX    EQU   *                   END OF ZZOB
*
ZZVI1    DC    0F'0'
         DC    Y(SSVIX-SSVI1)      LENGTH
         DC    AL1(SSVIVTWO)       VERSION
         DC    X'0'
         DC    CL4'SSVI'
ZZVIDATA EQU   *
         DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY
         DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY
ZZVIX    EQU   *                   END OF SSVI
         LTORG





         LTORG
         DS   0D

INSTWORK_DATA   DSECT
INSTWORK_SAVE   DS 18F             SAVE AREA FOR REGISTERS ON ENTRY
                ORG   INSTWORK_SAVE
INSTWORK_SAVEXX DS F
INSTWORK_SAVEBK DS F
INSTWORK_SAVEFW DS F
INSTWORK_SAVER14 DS F
INSTWORK_SAVER15 DS F
INSTWORK_SAVER0 DS F
INSTWORK_SAVER1 DS F
         ORG

*  AREAS USED FOR IEFSSREQ
ASSOB    DC    A(SSOB1)
*
SSOB1    DC    0F'0'
         DC    CL4'SSOB'
         DC    Y(SSOBX-SSOB1)      LENGTH
         DC    Y(SSOBSSVI)         VERSION REQUEST = 54
         DC    A(0)                USE LIFE OF JOB SSIB
SSOB1RET DC    F'0'
SSOBPTR  DC    A(SSVI1)
         DC    2F'0'
SSOBX    EQU   *                   END OF SSOB
*
SSVI1    DC    0F'0'
         DC    Y(SSVIX-SSVI1)      LENGTH
         DC    AL1(SSVIVTWO)       VERSION
         DC    X'0'
         DC    CL4'SSVI'
SSVIDATA EQU   *
SSD1     DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY
SSD2     DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY
SSVIX    EQU   *                   END OF SSVI
         DS    CL22

         DS   0D
INSTWORK_DATALEN EQU *-INSTWORK_DATA

            IEFSSOBH

            IEFSSVI DSECT=YES

            IEFJSSIB

            CVT DSECT=YES

            IEFJESCT
          END
./ ADD NAME=XMITSIZE 0103-05074-05179-1112-00014-00001-00000-TSO057
      ******************************************************************
      *                                                                *
      *   THIS IS THE MAX MESSAGE SIZE THAT CAN BE                     *
      *   HANDLED BY XMITMAIL IN BATCH, EXPRESSED AS 80 BYTE RECORDS.  *
      *                                                                *
      *   IT IS SET TO 4000 -> 320,000 BYTES.                          *
      *                                                                *
      *   YOU MAY TAILOR IT AS YOU WISH BEFORE COMPILING XMITMAIL      *
      *                                                                *
      *   XMITCICS IS CONSTRAINED BY THE 32K COMMAREA LIMIT AND THIS   *
      *   CAN NOT BE CHANGED BY ALTERING THIS COPYBOOK                 *
      *                                                                *
      ******************************************************************
                     OCCURS 4000.
./ ADD NAME=XMITSMS  0107-02361-05074-1521-00143-00143-00000-TSO057

      **************************************************************
      *   XMITSMS batch e-mail subroutine
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************










      ******************************************************************
      *                                                                *
      * SAMPLE PROGRAM TO SEND A MESSAGE TO AN EMAIL-TO-SMS GATEWAY    *
      * CUSTOMISE AS SUITABLE                                          *
      *                                                                *
      ******************************************************************

      ******************************************************************
      * HISTORY                                                        *
      ******************************************************************
      *                                                                *
      * 22 Dec 2002 1.0  written                                  AWR  *
      *                                                                *
      ******************************************************************

       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMITSMS'.
       ENVIRONMENT DIVISION.


       WORKING-STORAGE SECTION.




       01   W-WORK.
            04   XMITMAFM-CHARNO   PIC S9(8) COMP.
            04   OUTFILE-CHARNO    PIC S9(8) COMP.
            04   MAIL-COUNT        PIC S9(8) COMP VALUE 0.
            04   W-LINE            PIC X(255).



       01   XMITMAIL-TOS.
            04   XMITMAIL-TO       PIC X(80) OCCURS 100.

       01   XMITMAIL-CCS.
            04   XMITMAIL-CC       PIC X(80) OCCURS 10.

       01   XMITMAIL-BCCS.
            04   XMITMAIL-BCC      PIC X(80) OCCURS 10.

       01   XMITMAIL-SUBJECT       PIC X(80).


       COPY XMITMADF.


          01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.

       LINKAGE SECTION.


       COPY XMITMAC.

       01   XMITSMS-NUMBERS.
            04   XMITMAIL-NUMBER   PIC X(80) OCCURS 100.

       01   XMITSMS-MSGS.
            04   XMITSMS-MSG      PIC X(80)
                   COPY XMITSIZE.



       PROCEDURE DIVISION USING
            XMITMAIL-CONTROL
            XMITSMS-NUMBERS
            XMITSMS-MSGS
            .


           MOVE 'E' TO XMITMAIL-REPLY
           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC


           MOVE LOW-VALUES TO

                XMITMAIL-TOS
                XMITMAIL-CCS
                XMITMAIL-BCCS



           MOVE ' '        TO

                XMITMAIL-SUBJECT


           PERFORM VARYING MAIL-COUNT FROM 1 BY 1 UNTIL
           XMITSMS-NUMBER(MAIL-COUNT) = LOW-VALUES
                MOVE ' ' TO XMITMAIL-TO(MAIL-COUNT)
                STRING XMITSMS-NUMBER(MAIL-COUNT) DELIMITED SPACE
                '@FAX.CO.UK' DELIMITED SIZE
                INTO XMITMAIL-TO(MAIL-COUNT)
           END-PERFORM

            CALL XMITMAIL-NAME USING
                XMITMAIL-CONTROL
                XMITMAIL-TOS
                XMITMAIL-CCS
                XMITMAIL-BCCS
                XMITMAIL-SUBJECT
                XMITSMS-MSGS




           GOBACK.

./ ADD NAME=XMITUID  0105-10207-10207-1118-00060-00023-00041-TSO057
XMITUID CSECT
XMITUID AMODE 31
XMITUID RMODE ANY
R0     EQU   0
R1     EQU   1
R2     EQU   2
R3     EQU   3
R4     EQU   4
R5     EQU   5
R6     EQU   6
R7     EQU   7
R8     EQU   8
R9     EQU   9
R10    EQU   10
R11    EQU   11
R12    EQU   12
R13    EQU   13
R14    EQU   14
R15    EQU   15
       USING *,R15
         B     34(0,15)
         DC    AL1(29)
         DC    CL8'XMITUID '
         DC    CL8'VER 1 07'
         DC    CL8'/26/10 1'
         DC    CL5'1.12 '
         STM   14,12,12(13)
       DROP  R15
       USING XMITUID,R12
       LR    R12,R15
          L    R2,0(R1)
          USING PSA,0         (PSA)
          L    R1,PSATOLD   R1->TCB
          USING TCB,R1        (TCB)
          ICM  R1,15,TCBSENV  HAVE ACEE?
          BNZ  HAVEACEE     YES, USE IT
          L    R1,PSAAOLD   R1->ASCB
          USING ASCB,R1       (ASCB)
          L    R1,ASCBASXB  R1->ASXB
          USING ASXB,R1       (ASXB)
          ICM  R1,15,ASXBSENV HAVE ACEE?
          BNZ  HAVEACEE     YES, USE IT
          B    EXIT
HAVEACEE  DS   0H
          USING ACEE,R1       (ACEE)
          MVC  0(8,R2),ACEEUSRI  GET USERID
EXIT      DS   0H
          L     R14,12(R13)
          LM    R0,R12,20(R13)
          SLR   R15,R15
          BSM   0,R14



          IHAPSA
          IKJTCB
          IHAASCB
          IHAASXB
          IHAACEE
          END
./ ADD NAME=XMIT64   0102-05091-05094-1406-00211-00225-00000-TSO057


      **************************************************************
      *   XMIT64
      *   Copyright (C) 2000  Andy Robertson
      *
      *   This program is free software; you can redistribute
      *   it and/or modify it under the terms of the GNU
      *   General Public License as published by the Free
      *   Software Foundation; either version 2 of the
      *   License, or (at your option) any later version.
      *
      *   This program is distributed in the hope that it
      *   will be useful, but WITHOUT ANY WARRANTY; without
      *   even the implied warranty of MERCHANTABILITY or
      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
      *   General Public License for more details.
      *
      *   You should have received a copy of the GNU General
      *   Public License along with this program; if not,
      *   write to the Free Software Foundation, Inc., 675
      *   Mass Ave, Cambridge, MA 02139, USA.
      *
      **************************************************************


       IDENTIFICATION DIVISION.
       PROGRAM-ID.
              'XMIT64'.

      ******************************************************************
      *                                                                *
      * CONVERT TO 64-bit mime                                         *
      *                                                                *
      ******************************************************************

       ENVIRONMENT DIVISION.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01   W-CHAR-OFFSET PIC S9(8) COMP.
       01   W-64-OFFSET PIC S9(8) COMP.

       01   W-TRIAD-X.
            04 W-TRIAD       PIC S9(8) COMP.

       01   W-W    .
            04 W-REMAIN      PIC S9(8) COMP.
            04 W-no-of-triads PIC S9(8) COMP.

       01   W-mimechars.
            04 FILLER PIC X VALUE 'A'.
            04 FILLER PIC X VALUE 'B'.
            04 FILLER PIC X VALUE 'C'.
            04 FILLER PIC X VALUE 'D'.
            04 FILLER PIC X VALUE 'E'.
            04 FILLER PIC X VALUE 'F'.
            04 FILLER PIC X VALUE 'G'.
            04 FILLER PIC X VALUE 'H'.
            04 FILLER PIC X VALUE 'I'.
            04 FILLER PIC X VALUE 'J'.
            04 FILLER PIC X VALUE 'K'.
            04 FILLER PIC X VALUE 'L'.
            04 FILLER PIC X VALUE 'M'.
            04 FILLER PIC X VALUE 'N'.
            04 FILLER PIC X VALUE 'O'.
            04 FILLER PIC X VALUE 'P'.
            04 FILLER PIC X VALUE 'Q'.
            04 FILLER PIC X VALUE 'R'.
            04 FILLER PIC X VALUE 'S'.
            04 FILLER PIC X VALUE 'T'.
            04 FILLER PIC X VALUE 'U'.
            04 FILLER PIC X VALUE 'V'.
            04 FILLER PIC X VALUE 'W'.
            04 FILLER PIC X VALUE 'X'.
            04 FILLER PIC X VALUE 'Y'.
            04 FILLER PIC X VALUE 'Z'.
            04 filler pic x value 'a'.
            04 filler pic x value 'b'.
            04 filler pic x value 'c'.
            04 filler pic x value 'd'.
            04 filler pic x value 'e'.
            04 filler pic x value 'f'.
            04 filler pic x value 'g'.
            04 filler pic x value 'h'.
            04 filler pic x value 'i'.
            04 filler pic x value 'j'.
            04 filler pic x value 'k'.
            04 filler pic x value 'l'.
            04 filler pic x value 'm'.
            04 filler pic x value 'n'.
            04 filler pic x value 'o'.
            04 filler pic x value 'p'.
            04 filler pic x value 'q'.
            04 filler pic x value 'r'.
            04 filler pic x value 's'.
            04 filler pic x value 't'.
            04 filler pic x value 'u'.
            04 filler pic x value 'v'.
            04 filler pic x value 'w'.
            04 filler pic x value 'x'.
            04 filler pic x value 'y'.
            04 filler pic x value 'z'.
            04 FILLER PIC X VALUE '0'.
            04 FILLER PIC X VALUE '1'.
            04 FILLER PIC X VALUE '2'.
            04 FILLER PIC X VALUE '3'.
            04 FILLER PIC X VALUE '4'.
            04 FILLER PIC X VALUE '5'.
            04 FILLER PIC X VALUE '6'.
            04 FILLER PIC X VALUE '7'.
            04 FILLER PIC X VALUE '8'.
            04 FILLER PIC X VALUE '9'.
            04 FILLER PIC X VALUE '+'.
            04 FILLER PIC X VALUE '/'.
       linkage         section.

       01   f-char        pic x.
       01   f-length      pic s9(8) comp.
       01   f-64          pic x.


       procedure division using f-char f-length f-64
             .

           if f-length < 1 goback end-if

           divide f-length by 3 giving w-no-of-triads

           move 1 to w-char-offset
           move 1 to w-64-offset

           perform until w-no-of-triads < 1
               move 0 to w-triad
               move f-char(w-char-offset:3) to w-triad-x(2:3)
               add 3 to w-64-offset

               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset - 1
               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset - 1
               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset - 1
               move w-triad to w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-char-offset = w-char-offset + 3
               compute  w-64-offset = w-64-offset + 4
               compute  w-no-of-triads = w-no-of-triads - 1
           end-perform

           compute w-remain = f-length - w-char-offset + 1

           evaluate true
           when w-remain = 0
               goback
           when w-remain = 1
               move 0 to w-triad
               move f-char(w-char-offset:1) to w-triad-x(4:1)
               add 1 to w-64-offset

               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset - 1
               move w-triad to w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset + 2
               move '=='                  to f-64(w-64-offset:2)

           when w-remain = 2
               move 0 to w-triad
               move f-char(w-char-offset:2) to w-triad-x(3:2)
               add 2 to w-64-offset

               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset - 1
               divide w-triad by 64 giving w-triad remainder w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)
               compute  w-64-offset = w-64-offset - 1

               move w-triad to w-remain
               add 1 to w-remain
               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)

               compute  w-64-offset = w-64-offset + 3
               move '='                  to f-64(w-64-offset:1)
           end-evaluate




           goback  .

       END PROGRAM 'XMIT64'.
